<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ANYWORDLE</title>
  <link rel="icon" type="image/png" href="anywordle.png">
  <script type="text/javascript">
    (function (c, l, a, r, i, t, y) {
      c[a] = c[a] || function () { (c[a].q = c[a].q || []).push(arguments) };
      t = l.createElement(r); t.async = 1; t.src = "https://www.clarity.ms/tag/" + i;
      y = l.getElementsByTagName(r)[0]; y.parentNode.insertBefore(t, y);
    })(window, document, "clarity", "script", "qk8jzgjvf7");
  </script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f0f2f5;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
    }

    header {
      width: 100%;
      max-width: 500px;
      text-align: center;
      margin-bottom: 20px;
    }

    h1 {
      color: #333;
      font-size: 2.5rem;
      margin: 20px 0;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
    }

    .game-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
    }

    .board {
      display: flex;
      grid-template-rows: repeat(6, 1fr);
      gap: 5px;
      margin-bottom: 30px;
      flex-direction: column;
      align-items: flex-start;
      max-width: 100%;
      /* é˜²æ­¢è¶…å‡ºå®¹å™¨ */
      overflow-x: auto;
      /* å…è®¸æ¨ªå‘æ»šåŠ¨ */
    }

    .row {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 5px;
    }

    .tile {
      width: 50px;
      height: 50px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 2rem;
      font-weight: bold;
      background-color: white;
      border: 2px solid #d3d6da;
      text-transform: uppercase;
      transition: transform 0.1s ease;
    }

    .tile.filled {
      border-color: #939598;
    }

    .tile.correct {
      background-color: #6aaa64;
      border-color: #6aaa64;
      color: white;
    }

    .tile.present {
      background-color: #c9b458;
      border-color: #c9b458;
      color: white;
    }

    .tile.absent {
      background-color: #787c7e;
      border-color: #787c7e;
      color: white;
    }

    .tile.invalid {
      background-color: #ff4d4d;
      border-color: #ff4d4d;
      color: white;
    }

    .tile.flip {
      animation: flip 0.5s ease forwards;
    }

    @keyframes flip {
      0% {
        transform: rotateX(0);
      }

      45% {
        transform: rotateX(90deg);
      }

      55% {
        transform: rotateX(90deg);
      }

      100% {
        transform: rotateX(0);
      }
    }

    .keyboard {
      width: 100%;
      max-width: 500px;
    }

    .keyboard-row {
      display: flex;
      justify-content: center;
      width: 100%;
      margin-bottom: 8px;
    }

    .key {
      flex: 1;
      max-width: 40px;
      height: 50px;
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 0 3px;
      background-color: #d3d6da;
      border-radius: 4px;
      font-weight: bold;
      cursor: pointer;
      -webkit-user-select: none; /* Safariå…¼å®¹æ€§ */
      user-select: none;
      transition: all 0.2s ease;
    }

    .key.wide {
      flex: 1.5;
      max-width: 65px;
      font-size: 0.7rem;
    }

    .key:hover {
      background-color: #bbbdc1;
    }

    .key.correct {
      background-color: #6aaa64;
      color: white;
    }

    .key.present {
      background-color: #c9b458;
      color: white;
    }

    .key.absent {
      background-color: #787c7e;
      color: white;
    }

    .message {
      height: 30px;
      margin: 10px 0;
      font-weight: bold;
      text-align: center;
      color: #333;
    }

    .win {
      color: #6aaa64;
    }

    .lose {
      color: #c9b458;
    }

    /* æŒ‰é’®æ ·å¼ */
    .game-button {
      position: absolute;
      padding: 8px 16px;
      background-color: #6aaa64;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      z-index: 1000;
      top: 10px;
      text-decoration: none; /* å»é™¤é“¾æ¥ä¸‹åˆ’çº¿ */
    }

    .game-button:hover {
      opacity: 0.9;
    }

    .game-button.restart {
      background-color: #6aaa64;
      right: 10px;
    }

    .game-button.give-up {
      background-color: #787c7e;
      right: 10px;
    }

    .game-button.debug {
      background-color: #c9b458;
      right: 200px;
    }

    /* åˆ†äº«æŒ‰é’®æ ·å¼ */
    .share-container {
      width: 100%;
      max-width: 500px;
      display: flex;
      justify-content: center;
      margin-top: 20px;
    }

    .share {
      padding: 10px 20px;
      background-color: #6aaa64;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      text-decoration: none;
      font-weight: bold;
    }

    .share:hover {
      opacity: 0.9;
    }

    @media (max-width: 500px) {
      .tile {
        font-size: 1.5rem;
      }

      .key {
        height: 40px;
        max-width: 25px;
        font-size: 0.8rem;
      }

      .key.wide {
        max-width: 45px;
        font-size: 0.6rem;
      }

      h1 {
        font-size: 2rem;
      }
    }
  </style>
</head>

<body>
  <header>
    <h1>ANYWORDLE</h1>
  </header>

  <div class="game-container">
    <div class="message" id="message"></div>
    <div class="board" id="board">
      <!-- æ¸¸æˆæ¿å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
    </div>

    <div class="keyboard">
      <div class="keyboard-row">
        <div class="key" data-key="Q">Q</div>
        <div class="key" data-key="W">W</div>
        <div class="key" data-key="E">E</div>
        <div class="key" data-key="R">R</div>
        <div class="key" data-key="T">T</div>
        <div class="key" data-key="Y">Y</div>
        <div class="key" data-key="U">U</div>
        <div class="key" data-key="I">I</div>
        <div class="key" data-key="O">O</div>
        <div class="key" data-key="P">P</div>
      </div>
      <div class="keyboard-row">
        <div class="key" data-key="A">A</div>
        <div class="key" data-key="S">S</div>
        <div class="key" data-key="D">D</div>
        <div class="key" data-key="F">F</div>
        <div class="key" data-key="G">G</div>
        <div class="key" data-key="H">H</div>
        <div class="key" data-key="J">J</div>
        <div class="key" data-key="K">K</div>
        <div class="key" data-key="L">L</div>
      </div>
      <div class="keyboard-row">
        <div class="key wide" data-key="Backspace">âŒ«</div>
        <div class="key" data-key="Z">Z</div>
        <div class="key" data-key="X">X</div>
        <div class="key" data-key="C">C</div>
        <div class="key" data-key="V">V</div>
        <div class="key" data-key="B">B</div>
        <div class="key" data-key="N">N</div>
        <div class="key" data-key="M">M</div>
        <div class="key wide" data-key="Enter">ENTER</div>
      </div>
    </div>
  </div>
  BY <a href="https://ts8zs.com">TS8ZS.COM</a> WITH QWEN-CODER
  <script>
    // æ¸¸æˆé…ç½®

    const COMMON_WORDS_FILE = "commonwords.txt";
    const ALL_WORDS_FILE = "allwords.txt";
    let commonWords = []; // å¸¸ç”¨è¯åº“ï¼ˆç”¨äºå‡ºé¢˜ï¼‰
    let allWords = []; // å…¨éƒ¨è¯åº“ï¼ˆç”¨äºéªŒè¯ï¼‰
    // æ¸¸æˆçŠ¶æ€
    let targetWord = '';
    let currentRow = 0;
    let currentTile = 0;
    let gameOver = false;
    let wordsLoaded = false;  // æ ‡è®°å•è¯æ˜¯å¦å·²åŠ è½½
    let isAnimating = false;  // æ ‡è®°æ˜¯å¦æ­£åœ¨æ’­æ”¾åŠ¨ç”»

    // æ¯æ—¥è°œé¢˜çŠ¶æ€
    let dailyPuzzleDate = '';  // å½“å‰æ¯æ—¥è°œé¢˜çš„æ—¥æœŸ
    let puzzleCompleted = false;  // æ ‡è®°å½“æ—¥è°œé¢˜æ˜¯å¦å·²å®Œæˆ
    let isDailyPuzzle = true;  // æ ‡è®°æ˜¯å¦ä¸ºæ¯æ—¥è°œé¢˜æ¨¡å¼

    // ä¿å­˜æ¸¸æˆçŠ¶æ€åˆ°localStorage
    function saveGameState() {
      // åªåœ¨æ¸¸æˆè¿›è¡Œä¸­ä¿å­˜çŠ¶æ€
      if (gameOver) return;

      const gameState = {
        targetWord,
        currentRow,
        currentTile,
        gameOver,
        dailyPuzzleDate,
        puzzleCompleted,
        isDailyPuzzle,
        // ä¿å­˜æ‰€æœ‰è¡Œçš„æ•°æ®
        rows: []
      };

      // ä¿å­˜æ¯è¡Œçš„å­—æ¯å’ŒçŠ¶æ€
      for (let i = 0; i <= currentRow; i++) {
        const row = document.getElementById(`row-${i}`);
        if (row) {
          const rowData = {
            tiles: []
          };

          // ä¿å­˜æ¯ä¸ªæ ¼å­çš„å†…å®¹å’ŒçŠ¶æ€
          for (let j = 0; j < row.children.length; j++) {
            const tile = document.getElementById(`tile-${i}-${j}`);
            if (tile) {
              rowData.tiles.push({
                text: tile.textContent,
                classes: Array.from(tile.classList)
              });
            }
          }

          gameState.rows.push(rowData);
        }
      }

      // ä¿å­˜é”®ç›˜çŠ¶æ€
      const keyboardState = {};
      document.querySelectorAll('.key').forEach(key => {
        keyboardState[key.dataset.key] = Array.from(key.classList);
      });
      gameState.keyboardState = keyboardState;

      localStorage.setItem('wordleGameState', JSON.stringify(gameState));
    }

    // ä»localStorageæ¢å¤æ¸¸æˆçŠ¶æ€
    function restoreGameState() {
      const savedState = localStorage.getItem('wordleGameState');
      if (!savedState) return false;

      try {
        const gameState = JSON.parse(savedState);

        // å¦‚æœæ˜¯å·²ç»“æŸçš„æ¸¸æˆï¼Œä¸æ¢å¤çŠ¶æ€
        if (gameState.gameOver) {
          clearGameState();
          return false;
        }

        // æ¢å¤åŸºæœ¬çŠ¶æ€
        targetWord = gameState.targetWord;
        currentRow = gameState.currentRow;
        currentTile = gameState.currentTile;
        gameOver = gameState.gameOver;
        dailyPuzzleDate = gameState.dailyPuzzleDate;
        puzzleCompleted = gameState.puzzleCompleted;
        isDailyPuzzle = gameState.isDailyPuzzle;

        // æ¢å¤æ¸¸æˆæ¿
        const board = document.getElementById("board");
        board.innerHTML = "";

        for (let i = 0; i < 10; i++) {
          const row = document.createElement("div");
          row.classList.add("row");
          row.id = `row-${i}`;

          if (i < gameState.rows.length) {
            // æ¢å¤å·²æœ‰è¡Œ
            const rowData = gameState.rows[i];
            
            for (let j = 0; j < rowData.tiles.length; j++) {
              const tileData = rowData.tiles[j];
              const tile = document.createElement("div");
              tile.classList.add(...tileData.classes);
              tile.id = `tile-${i}-${j}`;
              tile.textContent = tileData.text;
              row.appendChild(tile);
            }
            
            // æ›´æ–°ç½‘æ ¼å¸ƒå±€
            row.style.gridTemplateColumns = `repeat(${rowData.tiles.length}, 1fr)`;
          } else {
            // åˆ›å»ºæ–°è¡Œï¼ˆåˆå§‹çŠ¶æ€ï¼‰
            const tile = document.createElement("div");
            tile.classList.add("tile");
            tile.id = `tile-${i}-0`;
            row.appendChild(tile);
            
            // è®¾ç½®åˆå§‹ç½‘æ ¼å¸ƒå±€
            row.style.gridTemplateColumns = "repeat(1, 1fr)";
          }

          board.appendChild(row);
        }

        // æ¢å¤é”®ç›˜çŠ¶æ€
        if (gameState.keyboardState) {
          Object.keys(gameState.keyboardState).forEach(keyValue => {
            const keyElement = document.querySelector(`.key[data-key="${keyValue}"]`);
            if (keyElement && gameState.keyboardState[keyValue]) {
              keyElement.className = ''; // æ¸…é™¤ç°æœ‰ç±»
              keyElement.classList.add(...gameState.keyboardState[keyValue]);
            }
          });
        }

        // æ›´æ–°æ¸¸æˆæ¨¡å¼ä¿¡æ¯
        updateGameModeMessage();

        return true;
      } catch (e) {
        console.error('æ¢å¤æ¸¸æˆçŠ¶æ€å¤±è´¥:', e);
        return false;
      }
    }

    // æ¸…é™¤ä¿å­˜çš„æ¸¸æˆçŠ¶æ€
    function clearGameState() {
      localStorage.removeItem('wordleGameState');
    }

    // åˆå§‹åŒ–æ¸¸æˆ
    async function initGame() {
      // ä¼˜å…ˆåŠ è½½å•è¯åº“
      if (!wordsLoaded) {
        // ä»ä¸¤ä¸ªæ–‡ä»¶å¹¶è¡ŒåŠ è½½å•è¯
        const [common, all] = await Promise.all([
          loadWordsFromFile(COMMON_WORDS_FILE),
          loadWordsFromFile(ALL_WORDS_FILE)
        ]);

        commonWords = common;
        allWords = all;
        wordsLoaded = true;

        // å¦‚æœä»»ä¸€è¯åº“ä¸ºç©ºï¼Œæ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
        if (commonWords.length === 0 || allWords.length === 0) {
          showMessage('FAILED TO LOAD WORD LIST, PLEASE CHECK FILE FORMAT', 'lose');
          return;
        }
      }

      // æ£€æŸ¥URLå‚æ•°ä¸­æ˜¯å¦æœ‰puzzleå‚æ•°å’Œæ—¥æœŸå‚æ•°
      const urlParams = new URLSearchParams(window.location.search);

      // åˆ¤æ–­æ˜¯å¦å­˜åœ¨URLå‚æ•°
      const hasUrlParams = urlParams.has('p') || urlParams.has('d');

      // å¦‚æœæ²¡æœ‰URLå‚æ•°ï¼Œæ‰å°è¯•æ¢å¤ä¿å­˜çš„çŠ¶æ€
      if (!hasUrlParams) {
        const hasRestoredState = restoreGameState();
        if (hasRestoredState) {
          // å¦‚æœæˆåŠŸæ¢å¤äº†çŠ¶æ€ï¼Œé‡æ–°ç»‘å®šäº‹ä»¶å¹¶è¿”å›
          document.addEventListener('keydown', handleKeyPress);
          document.querySelectorAll('.key').forEach(key => {
            key.addEventListener('click', () => {
              handleVirtualKeyPress(key.dataset.key);
            });
          });
          return;
        }
      }
      const puzzleParam = urlParams.get('p');
      const dateParam = urlParams.get('d');
      
      // å¦‚æœæœ‰æ—¥æœŸå‚æ•°ï¼Œä¼˜å…ˆä½¿ç”¨æ—¥æœŸå‚æ•°ï¼ˆå¿½ç•¥æ¯æ—¥è°œé¢˜æ˜¯å¦å®Œæˆçš„æ£€æŸ¥ï¼‰
      if (dateParam) {
        dailyPuzzleDate = dateParam;
        isDailyPuzzle = true;
        targetWord = getDailyPuzzleAnswer(dateParam, commonWords);
        // console.log('ç›®æ ‡å•è¯(æ¥è‡ªæ—¥æœŸ):', targetWord);
      }
      // å¦åˆ™ï¼Œå¦‚æœæœ‰puzzleå‚æ•°ï¼Œåˆ™ä½¿ç”¨è¯¥å‚æ•°ä½œä¸ºç›®æ ‡å•è¯
      else if (puzzleParam) {
        const unscrambledWord = caesarDecipher(puzzleParam, 3); // ä½¿ç”¨ä½ç§»3çš„å‡¯æ’’å¯†ç è§£å¯†
        if (unscrambledWord && unscrambledWord.match(/^[A-Z]+$/)) {
          targetWord = unscrambledWord;
          isDailyPuzzle = false; // æ ‡è®°ä¸ºéšæœºè°œé¢˜æ¨¡å¼
          // console.log('ç›®æ ‡å•è¯(æ¥è‡ªé“¾æ¥):', targetWord);
        } else {
          console.error('Invalid puzzle parameter in URL');
        }
      }

      // æ£€æŸ¥æ˜¯å¦å·²å®Œæˆå½“æ—¥è°œé¢˜ï¼ˆä»…åœ¨æ²¡æœ‰é€šè¿‡URLæŒ‡å®šå•è¯æ—¶ï¼‰
      if (!targetWord) {
        if (!dailyPuzzleDate) {  // å¦‚æœæ—¥æœŸè¿˜æœªè®¾ç½®ï¼ˆæ²¡æœ‰æ—¥æœŸå‚æ•°çš„æƒ…å†µï¼‰
          dailyPuzzleDate = getCurrentUTC8Date();
        }
        puzzleCompleted = isPuzzleCompletedForToday();

        // é»˜è®¤ä½¿ç”¨æ¯æ—¥è°œé¢˜ï¼ˆä»…åœ¨æ²¡æœ‰é€šè¿‡URLæŒ‡å®šå•è¯æ—¶ï¼‰
        isDailyPuzzle = true;
        
        // é€‰æ‹©ç›®æ ‡å•è¯
        if (isDailyPuzzle && !puzzleCompleted) {
          // ä½¿ç”¨æ¯æ—¥è°œé¢˜ç­”æ¡ˆ
          targetWord = getDailyPuzzleAnswer(dailyPuzzleDate, commonWords);
        } else {
          // ä½¿ç”¨éšæœºè°œé¢˜ç­”æ¡ˆæˆ–åœ¨æ¯æ—¥è°œé¢˜å®Œæˆåä½¿ç”¨éšæœºè°œé¢˜
          targetWord = commonWords[Math.floor(Math.random() * commonWords.length)];
          isDailyPuzzle = false; // æ ‡è®°ä¸ºéšæœºè°œé¢˜æ¨¡å¼
        }
      }

      // console.log('ç›®æ ‡å•è¯:', targetWord); // ç”¨äºè°ƒè¯•

      // åˆ›å»ºæ¸¸æˆæ¿
      createBoard();

      // æ˜¾ç¤ºæ¸¸æˆæ¨¡å¼ä¿¡æ¯
      updateGameModeMessage();

      // ç»‘å®šäº‹ä»¶
      document.addEventListener('keydown', handleKeyPress);

      // ç»‘å®šè™šæ‹Ÿé”®ç›˜äº‹ä»¶
      document.querySelectorAll('.key').forEach(key => {
        key.addEventListener('click', () => {
          handleVirtualKeyPress(key.dataset.key);
        });
      });
    }

    // æ›´æ–°æ¸¸æˆæ¨¡å¼æç¤ºä¿¡æ¯
    function updateGameModeMessage() {
      const dateStr = dailyPuzzleDate;
      if (isDailyPuzzle) {
        if (puzzleCompleted) {
          showMessage(`DAILY PUZZLE ${dailyPuzzleDate} (COMPLETED)`, 'win');
        } else {
          showMessage(`DAILY PUZZLE ${dailyPuzzleDate}`, 'win');
        }
      } else {
        showMessage('RANDOM PUZZLE', 'win');
      }
    }

    // åˆ‡æ¢æ¸¸æˆæ¨¡å¼
    function toggleGameMode() {
      if (isDailyPuzzle && puzzleCompleted) {
        showMessage("YOU'VE ALREADY COMPLETED TODAY'S PUZZLE!", 'lose');
        return;
      }

      isDailyPuzzle = !isDailyPuzzle;
      restartGame();
    }

    // åˆ›å»ºæ¸¸æˆæ¿
    function createBoard() {
      const board = document.getElementById("board");
      board.innerHTML = "";

      for (let i = 0; i < 10; i++) {
        const row = document.createElement("div");
        row.classList.add("row");
        row.id = `row-${i}`;

        // åˆå§‹åªæ˜¾ç¤ºç¬¬ä¸€ä¸ªæ ¼å­
        const tile = document.createElement("div");
        tile.classList.add("tile");
        tile.id = `tile-${i}-0`;
        row.appendChild(tile);

        // è®¾ç½®åˆå§‹ç½‘æ ¼å¸ƒå±€
        row.style.gridTemplateColumns = "repeat(1, 1fr)";

        board.appendChild(row);
      }

      // é‡ç½®å½“å‰è¡Œå’Œå½“å‰æ ¼å­è®¡æ•°å™¨
      currentRow = 0;
      currentTile = 0;
    }

    // å¤„ç†ç‰©ç†é”®ç›˜è¾“å…¥
    function handleKeyPress(e) {
      if (gameOver || isAnimating) return;  // æ·»åŠ å¯¹åŠ¨ç”»çŠ¶æ€çš„æ£€æŸ¥

      const key = e.key.toUpperCase();
      // å¤„ç†ç²˜è´´æ“ä½œ
      if (e.ctrlKey && key === 'V') {
        handlePaste();
      }
      // å¤„ç†å­—æ¯è¾“å…¥
      else if (/^[A-Z]$/.test(key)) {
        addLetter(key);
      }
      // å¤„ç†é€€æ ¼é”®
      else if (key === 'BACKSPACE') {
        removeLetter();
      }
      // å¤„ç†å›è½¦é”®
      else if (key === 'ENTER' && currentTile >= 1) {  // è‡³å°‘è¾“å…¥ä¸€ä¸ªå­—æ¯å³å¯æäº¤
        e.preventDefault(); // é˜»æ­¢é»˜è®¤çš„å›è½¦è¡Œä¸º
        submitGuess();
      }
    }

    // å¤„ç†ç²˜è´´æ“ä½œ
    async function handlePaste() {
      try {
        const text = await navigator.clipboard.readText();
        const letters = text.toUpperCase().replace(/[^A-Z]/g, "");

        // æ·»åŠ æ¯ä¸ªå­—æ¯
        for (const letter of letters) {
          if (/^[A-Z]$/.test(letter)) {
            addLetter(letter);
            // æ·»åŠ å°å»¶è¿Ÿä»¥è·å¾—æ›´å¥½çš„è§†è§‰æ•ˆæœ
            await new Promise((resolve) => setTimeout(resolve, 50));
          }
        }
      } catch (err) {
        console.error("ç²˜è´´æ“ä½œå¤±è´¥:", err);
      }
    }

    // å¤„ç†è™šæ‹Ÿé”®ç›˜è¾“å…¥
    function handleVirtualKeyPress(key) {
      if (gameOver || isAnimating) return;  // æ·»åŠ å¯¹åŠ¨ç”»çŠ¶æ€çš„æ£€æŸ¥

      if (key === 'Enter') {
        if (currentTile >= 1) {  // è‡³å°‘è¾“å…¥ä¸€ä¸ªå­—æ¯å³å¯æäº¤
          submitGuess();
        }
      } else if (key === 'Backspace') {
        if (currentTile > 0) {
          removeLetter();
        }
      } else {
        if (/^[A-Z]$/.test(key)) {
          addLetter(key);
        }
      }
    }

    // æ·»åŠ å­—æ¯åˆ°å½“å‰æ ¼å­
    function addLetter(letter) {
      const row = document.getElementById(`row-${currentRow}`);

      // ç¡®ä¿å½“å‰æ ¼å­å­˜åœ¨
      if (currentTile >= row.children.length) {
        const tile = document.createElement("div");
        tile.classList.add("tile");
        tile.id = `tile-${currentRow}-${row.children.length}`;
        row.appendChild(tile);
      }

      // è·å–å½“å‰æ ¼å­å¹¶å¡«å……å­—æ¯
      const tile = document.getElementById(
        `tile-${currentRow}-${currentTile}`
      );
      tile.textContent = letter;
      tile.classList.add("filled");

      // å¢åŠ ä¸€ä¸ªç©ºæ ¼å­ç”¨äºæç¤º
      if (currentTile + 1 >= row.children.length) {
        const newTile = document.createElement("div");
        newTile.classList.add("tile");
        newTile.id = `tile-${currentRow}-${row.children.length}`;
        row.appendChild(newTile);

        // æ›´æ–°ç½‘æ ¼å¸ƒå±€
        row.style.gridTemplateColumns = `repeat(${row.children.length}, 1fr)`;
      }

      currentTile++;
      
      // ä¿å­˜æ¸¸æˆçŠ¶æ€
      saveGameState();
    }

    // åˆ é™¤å½“å‰è¡Œçš„æœ€åä¸€ä¸ªå­—æ¯
    function removeLetter() {
      if (currentTile > 0) {
        currentTile--;
        const tile = document.getElementById(
          `tile-${currentRow}-${currentTile}`
        );
        tile.textContent = "";
        tile.classList.remove("filled");
      }
      // ç§»é™¤å½“å‰è¡Œæœ€åä¸€ä¸ªç©ºæ ¼å­
      removeEmptyTile();
      
      // ä¿å­˜æ¸¸æˆçŠ¶æ€
      saveGameState();
    }

    // ç§»é™¤å½“å‰è¡Œæœ€åä¸€ä¸ªç©ºæ ¼å­
    function removeEmptyTile() {
      const row = document.getElementById(`row-${currentRow}`);

      // å¦‚æœæœ€åä¸€ä¸ªæ ¼å­æ˜¯ç©ºçš„ï¼Œä¸”ä¸æ˜¯å”¯ä¸€çš„æ ¼å­ï¼Œåˆ™ç§»é™¤å®ƒ
      if (row.children.length > currentTile && row.children.length > 1) {
        row.removeChild(row.lastChild);
        // æ›´æ–°ç½‘æ ¼å¸ƒå±€
        row.style.gridTemplateColumns = `repeat(${row.children.length}, 1fr)`;
      }
    }

    // åˆ é™¤æŒ‡å®šè¡Œçš„æ‰€æœ‰ç©ºç™½æ ¼å­ï¼Œåªä¿ç•™æœ‰å­—æ¯çš„æ ¼å­
    function removeEmptyTilesInRow(rowId) {
      const row = document.getElementById(`row-${rowId}`);

      // ä»åå¾€å‰éå†ï¼Œé¿å…åˆ é™¤è¿‡ç¨‹ä¸­ç´¢å¼•å˜åŒ–çš„é—®é¢˜
      for (let i = row.children.length - 1; i >= 0; i--) {
        const tile = row.children[i];
        // å¦‚æœæ ¼å­æ˜¯ç©ºçš„ä¸”ä¸æ˜¯å”¯ä¸€çš„æ ¼å­ï¼Œåˆ™åˆ é™¤å®ƒ
        if (!tile.textContent && row.children.length > 1) {
          row.removeChild(tile);
        }
      }

      // å¦‚æœåˆ é™¤äº†æ ¼å­ï¼Œéœ€è¦æ›´æ–°ç½‘æ ¼å¸ƒå±€
      if (row.children.length > 0) {
        row.style.gridTemplateColumns = `repeat(${row.children.length}, 1fr)`;
      }
    }

    // æäº¤çŒœæµ‹
    function submitGuess() {
      // å¦‚æœæ­£åœ¨æ’­æ”¾åŠ¨ç”»ï¼Œä¸å¤„ç†æäº¤
      if (isAnimating) return;
      
      // è·å–å½“å‰è¡Œçš„å•è¯
      let guess = "";
      const row = document.getElementById(`row-${currentRow}`);

      // åªæ”¶é›†å·²å¡«å……çš„æ ¼å­å†…å®¹
      for (let i = 0; i < currentTile; i++) {
        const tile = document.getElementById(`tile-${currentRow}-${i}`);
        if (tile && tile.textContent) {
          guess += tile.textContent;
        }
      }

      // æ£€æŸ¥å•è¯æ˜¯å¦åœ¨å…¨éƒ¨è¯åº“ä¸­
      if (!allWords.includes(guess) && !commonWords.includes(guess) && targetWord !== guess) {
        showMessage("WORD NOT IN WORD LIST!");
        // æŠ–åŠ¨æ•ˆæœ
        row.style.animation = "shake 0.5s";
        setTimeout(() => {
          row.style.animation = "";
        }, 500);
        return;
      }

      // æ£€æŸ¥ç»“æœ
      checkGuess(guess);
    }

    // æ£€æŸ¥çŒœæµ‹ç»“æœ
    function checkGuess(guess) {
      // è®¾ç½®åŠ¨ç”»çŠ¶æ€
      isAnimating = true;

      // åˆ›å»ºç›®æ ‡å•è¯å­—æ¯è®¡æ•°
      const targetCounts = {};
      for (let i = 0; i < targetWord.length; i++) {
        const char = targetWord[i];
        targetCounts[char] = (targetCounts[char] || 0) + 1;
      }

      // ç¬¬1è½®ï¼šæ ‡è®°æ­£ç¡®ä½ç½®çš„å­—æ¯ï¼ˆç»¿è‰²ï¼‰
      const result = Array(guess.length).fill(null);
      for (let i = 0; i < Math.min(guess.length, targetWord.length); i++) {
        if (guess[i] === targetWord[i]) {
          result[i] = 'correct';
          targetCounts[guess[i]]--;
        }
      }


      // ç¬¬2è½®ï¼šæ ‡è®°å­˜åœ¨ä½†ä½ç½®é”™è¯¯çš„å­—æ¯ï¼ˆé»„è‰²ï¼‰
      for (let i = 0; i < guess.length; i++) {
        if (result[i] === null) {
          if (targetCounts[guess[i]] > 0) {
            result[i] = 'present';
            targetCounts[guess[i]]--;
          }
        }
      }

      // ç¬¬3è½®ï¼šæ ‡è®°å‰©ä½™çš„å­—æ¯ï¼ˆç°è‰²æˆ–çº¢è‰²ï¼‰
      for (let i = 0; i < guess.length; i++) {
        if (result[i] === null) {
          if (i >= targetWord.length) {
            result[i] = 'invalid'; // è¶…å‡ºé•¿åº¦çš„å­—æ¯æ ‡è®°ä¸ºçº¢è‰²
          } else {
            result[i] = 'absent'; // å…¶ä»–æœªæ ‡è®°çš„å­—æ¯æ ‡è®°ä¸ºç°è‰²
          }
        }
      }


      // æ˜¾ç¤ºç»“æœ
      let correctCount = 0;
      // æ·»åŠ åŠ¨ç”»å®Œæˆè®¡æ•°å™¨
      let animationCount = 0;
      
      // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰å­—æ¯éƒ½æ˜¯ç»¿è‰²ä¸”é•¿åº¦å°äºç›®æ ‡è¯
      const allGreen = result.every(r => r === 'correct');
      const needsQuestionMark = allGreen && guess.length < targetWord.length;
      
      // åŒæ—¶æ˜¾ç¤ºæ‰€æœ‰æ ¼å­çš„ç»“æœï¼Œä½†è¦ç­‰å¾…åŠ¨ç”»å®Œæˆ
      for (let i = 0; i < result.length; i++) {
        const tile = document.getElementById(`tile-${currentRow}-${i}`);
        if (result[i]) {
          tile.classList.add(result[i], 'flip');
          // ç›‘å¬åŠ¨ç”»å®Œæˆ
          tile.addEventListener('animationend', () => {
            animationCount++;
            if (animationCount === result.length + (needsQuestionMark ? 1 : 0)) {
              // æ‰€æœ‰åŠ¨ç”»å®Œæˆåï¼Œé‡ç½®åŠ¨ç”»çŠ¶æ€
              isAnimating = false;
            }
          }, { once: true }); // ç¡®ä¿äº‹ä»¶ç›‘å¬å™¨åªè§¦å‘ä¸€æ¬¡
        }

        // æ›´æ–°è™šæ‹Ÿé”®ç›˜çŠ¶æ€ - ä¿®å¤é¢œè‰²æ›´æ–°é€»è¾‘
        const keyElement = document.querySelector(`.key[data-key="${guess[i]}"]`);
        if (guess[i] && keyElement) {
          // å®šä¹‰ä¼˜å…ˆçº§é¡ºåº
          const priority = {
            'correct': 3,
            'present': 2,
            'absent': 1,
            'invalid': 1
          };
          
          // è·å–å½“å‰çŠ¶æ€çš„ä¼˜å…ˆçº§
          const currentState = keyElement.classList.contains('correct') ? 'correct' :
                              keyElement.classList.contains('present') ? 'present' :
                              keyElement.classList.contains('absent') ? 'absent' : null;
          
          const currentPriority = currentState ? priority[currentState] : 0;
          const newPriority = priority[result[i]];
          
          // åªæœ‰å½“æ–°çŠ¶æ€ä¼˜å…ˆçº§æ›´é«˜æ—¶æ‰æ›´æ–°
          if (newPriority > currentPriority) {
            // ç§»é™¤æ‰€æœ‰çŠ¶æ€ç±»
            keyElement.classList.remove('correct', 'present', 'absent');
            // æ·»åŠ æ–°çŠ¶æ€ç±»
            keyElement.classList.add(result[i] === 'invalid' ? 'absent' : result[i]);
          }
        }

        if (result[i] === 'correct') {
          correctCount++;
        }
      }

      // å¦‚æœéœ€è¦æ·»åŠ é—®å·ï¼Œåˆ›å»ºæ–°çš„é—®å·æ ¼å­
      if (needsQuestionMark) {
        const lastIndex = result.length;
        const tile = document.createElement('div');
        tile.classList.add('tile', 'absent', 'flip');
        tile.id = `tile-${currentRow}-${lastIndex}`;
        tile.textContent = '?';
        const row = document.getElementById(`row-${currentRow}`);
        row.appendChild(tile);
        
        // æ›´æ–°è¡Œçš„ç½‘æ ¼å¸ƒå±€ä»¥åŒ…å«æ–°çš„é—®å·æ ¼å­
        row.style.gridTemplateColumns = `repeat(${result.length + 1}, 1fr)`;
        
        // ç›‘å¬é—®å·æ ¼å­çš„åŠ¨ç”»å®Œæˆ
        tile.addEventListener('animationend', () => {
          animationCount++;
          if (animationCount === result.length + 1) {
            isAnimating = false;
          }
        }, { once: true });
      }

      // åˆ é™¤å½“å‰è¡Œçš„ç©ºç™½æ ¼å­
      removeEmptyTilesInRow(currentRow);

      // æ£€æŸ¥æ˜¯å¦èƒœåˆ©
      if (guess === targetWord) {
        const modeText = isDailyPuzzle ? `DAILY PUZZLE ${dailyPuzzleDate}` : 'RANDOM PUZZLE';
        showMessage(`CONGRATULATIONS! YOU GUESSED IT! [${modeText}]`, 'win');
        gameOver = true;
        // æ·»åŠ åˆ†äº«æŒ‰é’®
        addSharePuzzleButton();
        // åªæœ‰å½“æ˜¯æ¯æ—¥è°œé¢˜ä¸”æ—¥æœŸæ˜¯å½“å¤©æ—¶ï¼Œæ‰è®°å½•å®ŒæˆçŠ¶æ€
        if (isDailyPuzzle && dailyPuzzleDate === getCurrentUTC8Date()) {
          recordPuzzleCompletion();
        }
        // æ¸…é™¤ä¿å­˜çš„æ¸¸æˆçŠ¶æ€ï¼Œå› ä¸ºæ¸¸æˆå·²ç»ç»“æŸ
        clearGameState();
        isAnimating = false;
        // æ›´æ–°æŒ‰é’®çŠ¶æ€
        updateActionButton();
        return;
      }

      // æ£€æŸ¥æ˜¯å¦ç”¨å°½æ‰€æœ‰æœºä¼š
      if (currentRow === 9) {
        const modeText = isDailyPuzzle ? `DAILY PUZZLE ${dailyPuzzleDate}` : 'RANDOM PUZZLE';
        showMessage(`GAME OVER! THE CORRECT ANSWER IS: ${targetWord} [${modeText}]`, 'lose');
        gameOver = true;
        // æ·»åŠ åˆ†äº«æŒ‰é’®
        addSharePuzzleButton();
        // åªæœ‰å½“æ˜¯æ¯æ—¥è°œé¢˜ä¸”æ—¥æœŸæ˜¯å½“å¤©æ—¶ï¼Œæ‰è®°å½•å®ŒæˆçŠ¶æ€
        if (isDailyPuzzle && dailyPuzzleDate === getCurrentUTC8Date()) {
          recordPuzzleCompletion();
        }
        // æ¸…é™¤ä¿å­˜çš„æ¸¸æˆçŠ¶æ€ï¼Œå› ä¸ºæ¸¸æˆå·²ç»ç»“æŸ
        clearGameState();
        isAnimating = false;
        // æ›´æ–°æŒ‰é’®çŠ¶æ€
        updateActionButton();
        return;
      }

      // å‡†å¤‡ä¸‹ä¸€è¡Œ
      currentRow++;
      currentTile = 0;
      isAnimating = false;
      
      // ä¿å­˜æ¸¸æˆçŠ¶æ€
      saveGameState();
    }



    // ç”Ÿæˆéšæœºè°œé¢˜åˆ†äº«é“¾æ¥å¹¶åˆ†äº«æˆ–å¤åˆ¶åˆ°å‰ªè´´æ¿
    function copyPuzzleLinkToClipboard() {
      // åˆ›å»ºé“¾æ¥ï¼Œæ¯æ—¥è°œé¢˜åªéœ€è¦æ—¥æœŸï¼Œéšæœºè°œé¢˜éœ€è¦ä½¿ç”¨å‡¯æ’’å¯†ç æ··æ·†å•è¯
      let url;
      if (isDailyPuzzle) {
        url = `${window.location.origin}${window.location.pathname}?d=${dailyPuzzleDate}`;
      } else {
        const scrambledWord = caesarCipher(targetWord, 3); // ä½¿ç”¨ä½ç§»3çš„å‡¯æ’’å¯†ç 
        url = `${window.location.origin}${window.location.pathname}?p=${scrambledWord}`;
      }

      // ç”Ÿæˆemojiç½‘æ ¼
      let emojiGrid = `#ANYWORDLE ${isDailyPuzzle ? dailyPuzzleDate : ''}\n`;
      
      for (let i = 0; i <= currentRow; i++) {
        const row = document.getElementById(`row-${i}`);
        let rowEmojis = "";
        
        // æ”¶é›†æ‰€æœ‰æ ¼å­çš„ç»“æœ
        for (let j = 0; j < row.children.length; j++) {
          const tile = document.getElementById(`tile-${i}-${j}`);
          if (tile && tile.textContent) {
            if (tile.classList.contains('correct')) {
              rowEmojis += "ğŸŸ©";
            } else if (tile.classList.contains('present')) {
              rowEmojis += "ğŸŸ¨";
            } else if (tile.classList.contains('invalid')) {
              rowEmojis += "ğŸŸ¥";
            } else if (tile.classList.contains('absent')) {
              rowEmojis += "â¬œ";
            } else {
              break;
            }
          }
        }
        
        if (rowEmojis) {
          emojiGrid += rowEmojis + "\n";
        }
      }
      
      // æ·»åŠ ç½‘å€å’Œåˆ†äº«é“¾æ¥
      emojiGrid += `${url}`;
      
      // æ€»æ˜¯å…ˆå°è¯•å¤åˆ¶åˆ°å‰ªè´´æ¿
      navigator.clipboard.writeText(emojiGrid)
        .then(() => {
          // å¤åˆ¶æˆåŠŸåï¼Œå°è¯•ä½¿ç”¨ç³»ç»Ÿåˆ†äº«API
          if (navigator.share) {
            return navigator.share({
              title: '#ANYWORDLE',
              text: '#ANYWORDLE',
              url: url
            });
          } else {
            // å¦‚æœä¸æ”¯æŒåˆ†äº«APIï¼Œæ˜¾ç¤ºå¤åˆ¶æˆåŠŸæ¶ˆæ¯
            const originalText = document.getElementById("message").textContent;
            showMessage("RESULTS AND LINK COPIED TO CLIPBOARD!", "win");
            return new Promise(resolve => {
              setTimeout(() => {
                showMessage(originalText, "win");
                resolve();
              }, 2000);
            });
          }
        })
        .then(() => {
          // å¦‚æœåˆ†äº«æˆåŠŸï¼Œæ˜¾ç¤ºç›¸åº”æ¶ˆæ¯
          if (navigator.share) {
            const originalText = document.getElementById("message").textContent;
            showMessage("SHARED AND COPIED TO CLIPBOARD!", "win");
            setTimeout(() => {
              showMessage(originalText, "win");
            }, 2000);
          }
        })
        .catch(err => {
          console.error('Operation failed:', err);
          fallbackToCopyClipboard(emojiGrid);
        });
    }

    // å¤åˆ¶åˆ°å‰ªè´´æ¿çš„å›é€€æ–¹æ¡ˆ
    function fallbackToCopyClipboard(content) {
      navigator.clipboard.writeText(content)
        .then(() => {
          const originalText = document.getElementById("message").textContent;
          showMessage("Results and link copied to clipboard!", "win");
          setTimeout(() => {
            showMessage(originalText, "win");
          }, 2000);
        })
        .catch(err => {
          console.error('Failed to copy:', err);
          showMessage("Failed to copy to clipboard", "lose");
          setTimeout(() => {
            const modeText = isDailyPuzzle ? `DAILY PUZZLE ${dailyPuzzleDate}` : 'RANDOM PUZZLE';
            showMessage(`CONGRATULATIONS! YOU GUESSED IT! [${modeText}]`, 'win');
          }, 2000);
        });
    }

    // å‡¯æ’’å¯†ç åŠ å¯†
    function caesarCipher(str, shift) {
      return str.replace(/[A-Z]/g, (char) => {
        const code = char.charCodeAt(0);
        // å°†å­—ç¬¦æŒ‰æŒ‡å®šåç§»é‡ç§»åŠ¨
        const shifted = ((code - 65 + shift) % 26) + 65;
        return String.fromCharCode(shifted);
      });
    }

    // å‡¯æ’’å¯†ç è§£å¯†
    function caesarDecipher(str, shift) {
      return str.replace(/[A-Z]/g, (char) => {
        const code = char.charCodeAt(0);
        // åå‘ç§»åŠ¨å­—ç¬¦
        const shifted = ((code - 65 - shift + 26) % 26) + 65;
        return String.fromCharCode(shifted);
      });
    }

    // å‡ºé¢˜
    function generatePuzzle(puzzleWord) {
      var p= caesarCipher(puzzleWord.toUpperCase(), 3); // ä½¿ç”¨å‡¯æ’’å¯†ç åŠ å¯†
      console.log(`${window.location.origin}${window.location.pathname}?p=` + p);
    }

    // æ˜¾ç¤ºæ¶ˆæ¯
    function showMessage(text, className = '') {
      const messageElement = document.getElementById('message');
      messageElement.textContent = text;
      messageElement.className = 'message ' + className;
    }

    // ä»æ–‡ä»¶åŠ è½½å•è¯åº“
    async function loadWordsFromFile(filePath) {
      try {
        const response = await fetch(filePath);
        if (!response.ok) {
          throw new Error(`Unable to load file: ${filePath}`);
        }
        const text = await response.text();
        // æŒ‰è¡Œåˆ†å‰²å¹¶æ¸…ç†æ•°æ®ï¼ˆå»é™¤ç©ºè¡Œå’Œç©ºç™½å­—ç¬¦ï¼Œè½¬æ¢ä¸ºå¤§å†™ï¼‰
        return text.split('\n')
          .map(word => word.trim().toUpperCase())
          .filter(word => word.length > 0);
      } catch (error) {
        console.error(error);
        showMessage(`FAILED TO LOAD WORD LIST: ${filePath}`, 'lose');
        return [];  // è¿”å›ç©ºæ•°ç»„ä½œä¸ºåå¤‡
      }
    }

    // è·å–å½“å‰UTC+8æ—¥æœŸå­—ç¬¦ä¸² (YYYY-MM-DD)
    function getCurrentUTC8Date() {
      const now = new Date();
      // è½¬æ¢ä¸ºUTC+8æ—¶é—´
      const utc8Time = new Date(now.getTime() + (8 * 60 * 60 * 1000));
      const year = utc8Time.getUTCFullYear();
      const month = String(utc8Time.getUTCMonth() + 1).padStart(2, '0');
      const day = String(utc8Time.getUTCDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
    }

    // æ£€æŸ¥å½“æ—¥è°œé¢˜éšæœºæ˜¯å¦å·²å®Œæˆ
    function isPuzzleCompletedForToday() {
      const today = getCurrentUTC8Date();
      const lastCompleted = localStorage.getItem('wordleLastCompleted');
      const lastPuzzleDate = localStorage.getItem('wordlePuzzleDate');

      // å¦‚æœä¸Šæ¬¡å®Œæˆçš„æ—¥æœŸä¸å½“å‰æ—¥æœŸç›¸åŒï¼Œåˆ™å½“æ—¥è°œé¢˜å·²å®Œæˆ
      return lastCompleted && lastPuzzleDate === today;
    }

    // è®°å½•è°œé¢˜å®ŒæˆçŠ¶æ€
    function recordPuzzleCompletion() {
      const today = getCurrentUTC8Date();
      localStorage.setItem('wordleLastCompleted', new Date().toISOString());
      localStorage.setItem('wordlePuzzleDate', today);
    }

    // æ ¹æ®æ—¥æœŸè·å–æ¯æ—¥è°œé¢˜ç­”æ¡ˆ
    function getDailyPuzzleAnswer(dateString, wordList) {
      // ä½¿ç”¨æ›´å‡åŒ€çš„å“ˆå¸Œç®—æ³•æ¥é€‰æ‹©å•è¯
      // è¿™ä¸ªç®—æ³•ç»“åˆäº†å¤šä¸ªæŠ€æœ¯æ¥è·å¾—æ›´å¥½çš„åˆ†å¸ƒ
      let hash = 0;
      const len = dateString.length;
      
      // ä½¿ç”¨ä¸åŒçš„è´¨æ•°å’Œä½è¿ç®—ç»„åˆæ¥æé«˜éšæœºæ€§
      for (let i = 0; i < len; i++) {
        const char = dateString.charCodeAt(i);
        hash = ((hash << 5) - hash) + char;
        hash = hash & hash; // è½¬æ¢ä¸º32ä½æ•´æ•°
      }
      
      // æ·»åŠ ä¸€ä¸ªé¢å¤–çš„æ­¥éª¤æ¥è¿›ä¸€æ­¥æ‰“ä¹±å“ˆå¸Œå€¼
      hash = ((hash >> 16) ^ hash) * 0x45d9f3b;
      hash = ((hash >> 16) ^ hash) * 0x45d9f3b;
      hash = (hash >> 16) ^ hash;
      
      // ä½¿ç”¨å“ˆå¸Œå€¼é€‰æ‹©å•è¯åˆ—è¡¨ä¸­çš„å•è¯
      const index = Math.abs(hash) % wordList.length;
      return wordList[index];
    }

    // è°ƒè¯•åŠŸèƒ½ï¼šåœ¨æ§åˆ¶å°æŸ¥çœ‹æ¥ä¸‹æ¥10å¤©çš„æ¯æ—¥è°œé¢˜ç­”æ¡ˆ
    function printNext10DaysAnswers() {
      console.log("æ¥ä¸‹æ¥10å¤©çš„æ¯æ—¥è°œé¢˜ç­”æ¡ˆï¼š");
      
      const today = new Date();
      for (let i = 0; i < 10; i++) {
        // è®¡ç®—æœªæ¥ç¬¬iå¤©çš„æ—¥æœŸ
        const nextDate = new Date(today);
        nextDate.setDate(today.getDate() + i);
        
        // æ ¼å¼åŒ–ä¸º YYYY-MM-DD å­—ç¬¦ä¸²
        const year = nextDate.getFullYear();
        const month = String(nextDate.getMonth() + 1).padStart(2, '0');
        const day = String(nextDate.getDate()).padStart(2, '0');
        const dateString = `${year}-${month}-${day}`;
        
        // è·å–è¯¥æ—¥æœŸçš„æ¯æ—¥è°œé¢˜ç­”æ¡ˆ
        const answer = getDailyPuzzleAnswer(dateString, commonWords);
        console.log(`${dateString}: ${answer}`);
      }
    }

    // æ·»åŠ åˆ†äº«æŒ‰é’®
    function addSharePuzzleButton() {
      // å¦‚æœå·²ç»å­˜åœ¨åˆ†äº«æŒ‰é’®ï¼Œå…ˆç§»é™¤å®ƒ
      const existingContainer = document.querySelector('.share-container');
      if (existingContainer) {
        existingContainer.remove();
      }

      // åˆ›å»ºæ–°çš„åˆ†äº«æŒ‰é’®å®¹å™¨
      const shareContainer = document.createElement('div');
      shareContainer.classList.add('share-container');

      // åˆ›å»ºåˆ†äº«æŒ‰é’®
      const shareButton = document.createElement('button');
      shareButton.textContent = 'SHARE PUZZLE';
      shareButton.classList.add('share');
      shareButton.addEventListener('click', copyPuzzleLinkToClipboard);

      // å°†æŒ‰é’®æ·»åŠ åˆ°å®¹å™¨ä¸­
      shareContainer.appendChild(shareButton);

      // å°†å®¹å™¨æ·»åŠ åˆ°æ¸¸æˆå®¹å™¨ä¸­
      const gameContainer = document.querySelector('.game-container');
      gameContainer.appendChild(shareContainer);
    }

    // é‡æ–°å¼€å§‹æ¸¸æˆ
    function restartGame() {
      // å¦‚æœæ˜¯æ¯æ—¥è°œé¢˜ä¸”æ¸¸æˆæœªç»“æŸï¼Œæ˜¾ç¤ºè­¦å‘Š
      if (isDailyPuzzle && !gameOver) {
        let message = puzzleCompleted ? 
          "DAILY PUZZLE ALREADY COMPLETED. START A RANDOM PUZZLE?" :
          "ARE YOU SURE YOU WANT TO SKIP TODAY'S DAILY PUZZLE?";
        const confirmRestart = confirm(message);
        if (!confirmRestart) {
          return;
        } else { 
          recordPuzzleCompletion();
        }
      }
      
      // ç§»é™¤åˆ†äº«æŒ‰é’®
      const shareContainer = document.querySelector('.share-container');
      if (shareContainer) {
        shareContainer.remove();
      }

      // æ¸…é™¤ä¿å­˜çš„æ¸¸æˆçŠ¶æ€
      clearGameState();

      // åˆ›å»ºæ–°çš„URLå¯¹è±¡
      const url = new URL(window.location);
      
      // åˆ é™¤på‚æ•°ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
      url.searchParams.delete('p');
      url.searchParams.delete('d');
      
      // æ›´æ–°æµè§ˆå™¨å†å²è®°å½•ï¼Œä¸é‡æ–°åŠ è½½é¡µé¢
      window.history.replaceState({}, '', url);

      // é‡ç½®æ¸¸æˆçŠ¶æ€
      currentRow = 0;
      currentTile = 0;
      gameOver = false;
      isAnimating = false;
      
      // é€‰æ‹©ç›®æ ‡å•è¯ï¼ˆä½¿ç”¨æ¯æ—¥è°œé¢˜ï¼‰
      dailyPuzzleDate = getCurrentUTC8Date();
      puzzleCompleted = isPuzzleCompletedForToday();
      isDailyPuzzle = true;
      
      if (isDailyPuzzle && !puzzleCompleted) {
        // ä½¿ç”¨æ¯æ—¥è°œé¢˜ç­”æ¡ˆ
        targetWord = getDailyPuzzleAnswer(dailyPuzzleDate, commonWords);
      } else {
        // ä½¿ç”¨éšæœºè°œé¢˜ç­”æ¡ˆæˆ–åœ¨æ¯æ—¥è°œé¢˜å®Œæˆåä½¿ç”¨éšæœºè°œé¢˜
        targetWord = commonWords[Math.floor(Math.random() * commonWords.length)];
        isDailyPuzzle = false; // æ ‡è®°ä¸ºéšæœºè°œé¢˜æ¨¡å¼
      }

      // console.log('æ–°ç›®æ ‡å•è¯:', targetWord); // ç”¨äºè°ƒè¯•

      // æ¸…é™¤æ¶ˆæ¯
      showMessage('');

      // é‡æ–°åˆ›å»ºæ¸¸æˆæ¿
      createBoard();

      // æ›´æ–°æ¸¸æˆæ¨¡å¼ä¿¡æ¯
      updateGameModeMessage();

      // é‡ç½®è™šæ‹Ÿé”®ç›˜é¢œè‰²
      document.querySelectorAll('.key').forEach(key => {
        key.classList.remove('correct', 'present', 'absent');
        // ç§»é™¤æ‰€æœ‰ç°æœ‰çš„ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨
        const clone = key.cloneNode(true);
        key.parentNode.replaceChild(clone, key);
        // æ·»åŠ æ–°çš„ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨
        clone.addEventListener('click', () => {
          handleVirtualKeyPress(clone.dataset.key);
        });
      });
      
      // ç§»é™¤åˆ†äº«æŒ‰é’®ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
      const existingContainer = document.querySelector('.share-container');
      if (existingContainer) {
        existingContainer.remove();
      }
      
      // é‡æ–°ç»‘å®šé”®ç›˜äº‹ä»¶
      document.removeEventListener('keydown', handleKeyPress);
      document.addEventListener('keydown', handleKeyPress);
    }

    // æ”¾å¼ƒæ¸¸æˆ
    function giveUp() {
      if (!gameOver) {
        const modeText = isDailyPuzzle ? `DAILY PUZZLE ${dailyPuzzleDate}` : 'RANDOM PUZZLE';
        showMessage(`YOU GAVE UP! THE CORRECT ANSWER IS: ${targetWord} [${modeText}]`, 'lose');
        gameOver = true;
        
        // æ”¾å¼ƒæ—¶æ·»åŠ åˆ†äº«æŒ‰é’®
        addSharePuzzleButton();
        
        // åªæœ‰å½“æ˜¯æ¯æ—¥è°œé¢˜ä¸”æ—¥æœŸæ˜¯å½“å¤©æ—¶ï¼Œæ‰è®°å½•å®ŒæˆçŠ¶æ€
        if (isDailyPuzzle && dailyPuzzleDate === getCurrentUTC8Date()) {
          recordPuzzleCompletion();
        }
        // æ¸…é™¤ä¿å­˜çš„æ¸¸æˆçŠ¶æ€ï¼Œå› ä¸ºæ¸¸æˆå·²ç»ç»“æŸ
        clearGameState();
        // æ›´æ–°æŒ‰é’®çŠ¶æ€
        updateActionButton();
      }
    }

    // æ·»åŠ æŠ–åŠ¨åŠ¨ç”»æ ·å¼
    const style = document.createElement("style");
    style.textContent = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                20%, 60% { transform: translateX(-5px); }
                40%, 80% { transform: translateX(5px); }
            }
            
            // åŠ¨æ€è°ƒæ•´è¡Œçš„ç½‘æ ¼å¸ƒå±€
            .row {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(1fr, 1fr));
                gap: 5px;
            }
        `;
    document.head.appendChild(style);

    // åˆå§‹åŒ–æ¸¸æˆ
    window.onload = async function () {
      // åˆå§‹åŒ–æ¸¸æˆ
      await initGame();
      
      // åœ¨æ§åˆ¶å°æ‰“å°æ¥ä¸‹æ¥10å¤©çš„æ¯æ—¥è°œé¢˜ç­”æ¡ˆ
      // printNext10DaysAnswers();

      // æ·»åŠ ç»„åˆæŒ‰é’®ï¼ˆGive Up/Restartï¼‰
      const actionButton = document.createElement('button');
      actionButton.id = 'actionButton';
      actionButton.textContent = 'GIVE UP';
      actionButton.classList.add('game-button', 'give-up');

      actionButton.addEventListener('click', () => {
        if (!gameOver) {
          giveUp();
        } else {
          restartGame();
        }
      });

      document.body.appendChild(actionButton);

      // æ›´æ–°æŒ‰é’®çŠ¶æ€çš„å‡½æ•°
      window.updateActionButton = function() {
        const button = document.getElementById('actionButton');
        if (button) {
          if (gameOver) {
            button.textContent = 'RESTART';
            button.classList.remove('give-up');
            button.classList.add('restart');
          } else {
            button.textContent = 'GIVE UP';
            button.classList.remove('restart');
            button.classList.add('give-up');
          }
        }
      };

    };
  </script>
</body>

</html>