<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ANYWORDLE</title>
    <link rel="icon" type="image/png" href="anywordle.png" />
    <script type="text/javascript">
      (function (c, l, a, r, i, t, y) {
        c[a] =
          c[a] ||
          function () {
            (c[a].q = c[a].q || []).push(arguments);
          };
        t = l.createElement(r);
        t.async = 1;
        t.src = "https://www.clarity.ms/tag/" + i;
        y = l.getElementsByTagName(r)[0];
        y.parentNode.insertBefore(t, y);
      })(window, document, "clarity", "script", "qk8jzgjvf7");
    </script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f0f2f5;
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
        padding: 20px;
      }

      header {
        width: 100%;
        max-width: 500px;
        text-align: center;
        margin-bottom: 20px;
      }

      h1 {
        color: #333;
        font-size: 2.5rem;
        margin: 20px 0;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
      }

      /* æ·»åŠ é“¾æ¥æ ·å¼ */
      a {
        color: #87ceeb; /* å¤©è“è‰² */
      }

      a:visited {
        color: #800080; /* æš—ç´«è‰² */
      }

      .game-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 100%;
      }

      .board {
        display: flex;
        grid-template-rows: repeat(6, 1fr);
        gap: 5px;
        margin-bottom: 30px;
        flex-direction: column;
        align-items: flex-start;
        max-width: 100%;
        /* é˜²æ­¢è¶…å‡ºå®¹å™¨ */
        overflow-x: auto;
        /* å…è®¸æ¨ªå‘æ»šåŠ¨ */
      }

      .row {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 5px;
      }

      .tile {
        width: 50px;
        height: 50px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 2rem;
        font-weight: bold;
        background-color: white;
        border: 2px solid #d3d6da;
        text-transform: uppercase;
        transition: transform 0.1s ease;
      }

      .tile.filled {
        border-color: #939598;
      }

      .tile.correct {
        background-color: #6aaa64;
        border-color: #6aaa64;
        color: white;
      }

      .tile.present {
        background-color: #c9b458;
        border-color: #c9b458;
        color: white;
      }

      .tile.absent {
        background-color: #787c7e;
        border-color: #787c7e;
        color: white;
      }

      .tile.invalid {
        background-color: #ff4d4d;
        border-color: #ff4d4d;
        color: white;
      }

      .tile.flip {
        animation: flip 0.5s ease forwards;
      }

      @keyframes flip {
        0% {
          transform: rotateX(0);
        }

        45% {
          transform: rotateX(90deg);
        }

        55% {
          transform: rotateX(90deg);
        }

        100% {
          transform: rotateX(0);
        }
      }

      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        20%,
        60% {
          transform: translateX(-5px);
        }
        40%,
        80% {
          transform: translateX(5px);
        }
      }

      .row {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(1fr, 1fr));
        gap: 5px;
      }

      /* çº¸ç‰‡çƒŸèŠ±ç‰¹æ•ˆæ ·å¼ */
      .confetti {
        position: fixed;
        width: 10px;
        height: 10px;
        background-color: #f00;
        opacity: 0;
        z-index: 9999;
      }

      /* çº¸ç‰‡çƒŸèŠ±ç‰¹æ•ˆæ ·å¼ */
      .confetti {
        position: fixed;
        width: 10px;
        height: 10px;
        background-color: #f00;
        opacity: 0;
        z-index: 9999;
      }

      .keyboard {
        width: 100%;
        max-width: 500px;
      }

      /* æ·»åŠ Hard Modeé€‰é¡¹æ ·å¼ */
      .hard-mode-option {
        margin-top: 15px;
        text-align: center;
      }

      .hard-mode-option label {
        display: inline-flex;
        align-items: center;
        padding: 10px 15px;
        background-color: #e6f7ff;
        border: 1px solid #91d5ff;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.3s;
        font-size: 0.9rem;
        color: #333;
      }

      .hard-mode-option label:hover {
        background-color: #ff4d4f;
        border-color: #f5222d;
      }

      .hard-mode-option label:has(input:checked) {
        background-color: #ff4d4f;
        border-color: #f5222d;
        color: white;
      }

      .hard-mode-option label:has(input:checked):hover {
        background-color: #f5222d;
        border-color: #cf1322;
      }

      .hard-mode-option label:has(input:disabled) {
        background-color: #f5f5f5;
        border-color: #d9d9d9;
        color: #999;
        cursor: not-allowed;
      }

      .hard-mode-option input[type="checkbox"] {
        margin-right: 8px;
        transform: scale(1.2);
      }

      .keyboard-row {
        display: flex;
        justify-content: center;
        width: 100%;
        margin-bottom: 8px;
      }

      .key {
        flex: 1;
        max-width: 40px;
        height: 50px;
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 0 3px;
        background-color: #d3d6da;
        border-radius: 4px;
        font-weight: bold;
        cursor: pointer;
        -webkit-user-select: none; /* Safariå…¼å®¹æ€§ */
        user-select: none;
        transition: all 0.2s ease;
      }

      .key.wide {
        flex: 1.5;
        max-width: 65px;
        font-size: 0.7rem;
      }

      .key:hover {
        background-color: #bbbdc1;
      }

      .key.correct {
        background-color: #6aaa64;
        color: white;
      }

      .key.present {
        background-color: #c9b458;
        color: white;
      }

      .key.absent {
        background-color: #787c7e;
        color: white;
      }

      .message {
        height: 30px;
        margin: 10px 0;
        font-weight: bold;
        text-align: center;
        color: #333;
      }

      .win {
        color: #6aaa64;
      }

      .hint {
        color: #c9b458;
      }
      
      .lose {
        color: #ff4d4d;
      }

      /* æŒ‰é’®æ ·å¼ */
      .game-button {
        position: absolute;
        padding: 8px 16px;
        background-color: #6aaa64;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        z-index: 1000;
        top: 10px;
        text-decoration: none; /* å»é™¤é“¾æ¥ä¸‹åˆ’çº¿ */
      }

      .game-button:hover {
        opacity: 0.9;
      }

      .game-button.restart {
        background-color: #6aaa64;
        right: 10px;
      }

      .game-button.give-up {
        background-color: #787c7e;
        right: 10px;
      }

      .game-button.debug {
        background-color: #c9b458;
        right: 200px;
      }

      /* åˆ†äº«æŒ‰é’®æ ·å¼ */
      .share-container {
        width: 100%;
        max-width: 500px;
        display: flex;
        justify-content: center;
        margin-top: 20px;
      }

      .share {
        padding: 10px 20px;
        background-color: #6aaa64;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        text-decoration: none;
        font-weight: bold;
      }

      .share:hover {
        opacity: 0.9;
      }

      /* æ¨¡æ€æ¡†æ ·å¼ */
      .modal {
        display: none;
        position: fixed;
        z-index: 1001;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
      }

      .modal-content {
        background-color: #fff;
        margin: 15% auto;
        padding: 20px;
        border: 1px solid #888;
        border-radius: 8px;
        width: 80%;
        max-width: 500px;
        text-align: center;
        position: relative;
        animation: modalopen 0.4s;
      }

      @keyframes modalopen {
        from {opacity: 0; transform: translateY(-60px);}
        to {opacity: 1; transform: translateY(0);}
      }

      .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        position: absolute;
        right: 15px;
        top: 0;
      }

      .close:hover,
      .close:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
      }

      .modal-header {
        margin-bottom: 15px;
      }

      .modal-body {
        margin-bottom: 20px;
        line-height: 1.5;
      }

      .modal-button {
        background-color: #6aaa64;
        color: white;
        border: none;
        padding: 10px 20px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        margin: 4px 2px;
        cursor: pointer;
        border-radius: 4px;
      }

      .modal-button:hover {
        opacity: 0.9;
      }

      /* textareaæœ€å°å°ºå¯¸ */
      textarea {
        min-height: 150px;
        width: 80%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-family: monospace;
        font-size: 14px;
        resize: vertical;
        margin-top: 10px;
        background-color: #f9f9f9;
      }

      @media (max-width: 500px) {
        .tile {
          width: 40px;
          height: 40px;
          font-size: 1.5rem;
        }

        .key {
          height: 40px;
          max-width: 25px;
          font-size: 0.8rem;
        }

        .key.wide {
          max-width: 45px;
          font-size: 0.6rem;
        }

        h1 {
          font-size: 2rem;
        }
      }

      /* é’ˆå¯¹æ›´å°å±å¹•çš„ä¼˜åŒ– */
      @media (max-width: 400px) {
        .tile {
          width: 35px;
          height: 35px;
          font-size: 1.3rem;
        }



        h1 {
          font-size: 1.8rem;
        }
      }

      /* é’ˆå¯¹è¶…å°å±å¹•çš„ä¼˜åŒ– */
      @media (max-width: 350px) {
        .tile {
          width: 30px;
          height: 30px;
          font-size: 1.1rem;
        }



        h1 {
          font-size: 1.5rem;
        }
      }
    </style>
  </head>

  <body>
    <header>
      <h1>ANYWORDLE</h1>
    </header>

    <!-- æ¨¡æ€æ¡† -->
    <div id="modal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <div class="modal-header">
          <h2 id="modal-title"></h2>
        </div>
        <div class="modal-body">
          <p id="modal-message"></p>
        </div>
        <div class="modal-footer">
          <button class="modal-button" id="modal-ok-button">OK</button>
        </div>
      </div>
    </div>

    <div class="game-container">
      <div class="message" id="message"></div>
      <div class="board" id="board">
        <!-- æ¸¸æˆæ¿å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
      </div>

      <div class="keyboard">
        <div class="keyboard-row">
          <div class="key" data-key="Q">Q</div>
          <div class="key" data-key="W">W</div>
          <div class="key" data-key="E">E</div>
          <div class="key" data-key="R">R</div>
          <div class="key" data-key="T">T</div>
          <div class="key" data-key="Y">Y</div>
          <div class="key" data-key="U">U</div>
          <div class="key" data-key="I">I</div>
          <div class="key" data-key="O">O</div>
          <div class="key" data-key="P">P</div>
        </div>
        <div class="keyboard-row">
          <div class="key" data-key="A">A</div>
          <div class="key" data-key="S">S</div>
          <div class="key" data-key="D">D</div>
          <div class="key" data-key="F">F</div>
          <div class="key" data-key="G">G</div>
          <div class="key" data-key="H">H</div>
          <div class="key" data-key="J">J</div>
          <div class="key" data-key="K">K</div>
          <div class="key" data-key="L">L</div>
        </div>
        <div class="keyboard-row">
          <div class="key wide" data-key="Backspace">âŒ«</div>
          <div class="key" data-key="Z">Z</div>
          <div class="key" data-key="X">X</div>
          <div class="key" data-key="C">C</div>
          <div class="key" data-key="V">V</div>
          <div class="key" data-key="B">B</div>
          <div class="key" data-key="N">N</div>
          <div class="key" data-key="M">M</div>
          <div class="key wide" data-key="Enter">ENTER</div>
        </div>
      </div>
      
      <!-- æ·»åŠ hardmodeé€‰é¡¹ -->
      <div class="hard-mode-option">
        <label>
          <input type="checkbox" id="hardModeToggle"> 
          <span>HARD MODE - ONLY LETTERS NOT MARKED GRAY USEABLE</span>
        </label>
      </div>
    </div>
    BY <a href="https://ts8zs.com">TS8ZS.COM</a> WITH QWEN-CODER
    <script>
      // æ¸¸æˆé…ç½®

      const COMMON_WORDS_FILE = "commonwords.txt";
      const ALL_WORDS_FILE = "allwords.txt";
      let commonWords = []; // å¸¸ç”¨è¯åº“ï¼ˆç”¨äºå‡ºé¢˜ï¼‰
      let allWords = []; // å…¨éƒ¨è¯åº“ï¼ˆç”¨äºéªŒè¯ï¼‰
      // æ¸¸æˆçŠ¶æ€
      let targetWord = "";
      let currentRow = 0;
      let currentTile = 0;
      let gameOver = false;
      let wordsLoaded = false; // æ ‡è®°å•è¯æ˜¯å¦å·²åŠ è½½
      let isAnimating = false; // æ ‡è®°æ˜¯å¦æ­£åœ¨æ’­æ”¾åŠ¨ç”»
      let maxGuesses = 8;
      let recommendGuesses = 8; // æ¨èçŒœæµ‹æ¬¡æ•°
      let hardMode = false; // Hard Mode çŠ¶æ€

      // æ¯æ—¥è°œé¢˜çŠ¶æ€
      let dailyPuzzleDate = ""; // å½“å‰æ¯æ—¥è°œé¢˜çš„æ—¥æœŸ
      let puzzleCompleted = false; // æ ‡è®°å½“æ—¥è°œé¢˜æ˜¯å¦å·²å®Œæˆ
      let isDailyPuzzle = true; // æ ‡è®°æ˜¯å¦ä¸ºæ¯æ—¥è°œé¢˜æ¨¡å¼

      // ä¿å­˜æ¸¸æˆçŠ¶æ€åˆ°localStorage
      function saveGameState() {
        // åªåœ¨æ¸¸æˆè¿›è¡Œä¸­ä¿å­˜çŠ¶æ€
        if (gameOver) return;

        const gameState = {
          targetWord,
          currentRow,
          currentTile,
          gameOver,
          dailyPuzzleDate,
          puzzleCompleted,
          isDailyPuzzle,
          maxGuesses, // ä¿å­˜å½“å‰æœ€å¤§è¡Œæ•°
          hardMode, // ä¿å­˜hardModeçŠ¶æ€
          // ä¿å­˜æ‰€æœ‰è¡Œçš„æ•°æ®
          rows: [],
        };

        // ä¿å­˜æ¯è¡Œçš„å­—æ¯å’ŒçŠ¶æ€
        for (let i = 0; i <= currentRow; i++) {
          const row = document.getElementById(`row-${i}`);
          if (row) {
            const rowData = {
              tiles: [],
            };

            // ä¿å­˜æ¯ä¸ªæ ¼å­çš„å†…å®¹å’ŒçŠ¶æ€
            for (let j = 0; j < row.children.length; j++) {
              const tile = document.getElementById(`tile-${i}-${j}`);
              if (tile) {
                rowData.tiles.push({
                  text: tile.innerHTML,
                  classes: Array.from(tile.classList),
                });
              }
            }

            gameState.rows.push(rowData);
          }
        }

        // ä¿å­˜é”®ç›˜çŠ¶æ€
        const keyboardState = {};
        document.querySelectorAll(".key").forEach((key) => {
          keyboardState[key.dataset.key] = Array.from(key.classList);
        });
        gameState.keyboardState = keyboardState;

        localStorage.setItem("wordleGameState", JSON.stringify(gameState));
      }

      // ä»localStorageæ¢å¤æ¸¸æˆçŠ¶æ€
      function restoreGameState() {
        const savedState = localStorage.getItem("wordleGameState");
        if (!savedState) return false;

        try {
          const gameState = JSON.parse(savedState);

          // å¦‚æœæ˜¯å·²ç»“æŸçš„æ¸¸æˆï¼Œä¸æ¢å¤çŠ¶æ€
          if (gameState.gameOver) {
            clearGameState();
            return false;
          }

          // æ¢å¤åŸºæœ¬çŠ¶æ€
          targetWord = gameState.targetWord;
          currentRow = gameState.currentRow;
          currentTile = gameState.currentTile;
          gameOver = gameState.gameOver;
          dailyPuzzleDate = gameState.dailyPuzzleDate;
          puzzleCompleted = gameState.puzzleCompleted;
          isDailyPuzzle = gameState.isDailyPuzzle;
          maxGuesses = gameState.maxGuesses || 6; // æ¢å¤æœ€å¤§è¡Œæ•°ï¼Œé»˜è®¤ä¸º6
          hardMode = gameState.hardMode || false; // æ¢å¤hardModeçŠ¶æ€ï¼Œé»˜è®¤ä¸ºfalse

          // æ¢å¤æ¸¸æˆæ¿
          const board = document.getElementById("board");
          board.innerHTML = "";

          // æ ¹æ®ä¿å­˜çš„æœ€å¤§è¡Œæ•°åˆ›å»ºè¡Œ
          for (let i = 0; i < maxGuesses; i++) {
            const row = document.createElement("div");
            row.classList.add("row");
            row.id = `row-${i}`;

            if (i < gameState.rows.length) {
              // æ¢å¤å·²æœ‰è¡Œ
              const rowData = gameState.rows[i];

              for (let j = 0; j < rowData.tiles.length; j++) {
                const tileData = rowData.tiles[j];
                const tile = document.createElement("div");
                tile.classList.add(...tileData.classes);
                tile.id = `tile-${i}-${j}`;
                tile.innerHTML = tileData.text;
                row.appendChild(tile);
              }

              // æ›´æ–°ç½‘æ ¼å¸ƒå±€
              row.style.gridTemplateColumns = `repeat(${rowData.tiles.length}, 1fr)`;
            } else {
              // åˆ›å»ºæ–°è¡Œï¼ˆåˆå§‹çŠ¶æ€ï¼‰
              const tile = document.createElement("div");
              tile.classList.add("tile");
              tile.id = `tile-${i}-0`;
              row.appendChild(tile);

              // è®¾ç½®åˆå§‹ç½‘æ ¼å¸ƒå±€
              row.style.gridTemplateColumns = "repeat(1, 1fr)";
            }

            board.appendChild(row);
          }

          // æ¢å¤é”®ç›˜çŠ¶æ€
          if (gameState.keyboardState) {
            Object.keys(gameState.keyboardState).forEach((keyValue) => {
              const keyElement = document.querySelector(
                `.key[data-key="${keyValue}"]`
              );
              if (keyElement && gameState.keyboardState[keyValue]) {
                keyElement.className = ""; // æ¸…é™¤ç°æœ‰ç±»
                keyElement.classList.add(...gameState.keyboardState[keyValue]);
              }
            });
          }

          // æ¢å¤hardModeå¤é€‰æ¡†çŠ¶æ€
          document.getElementById('hardModeToggle').checked = hardMode;
          
          // å½“ç¬¬äºŒè¡Œhardmodeæœªå¼€å¯æ—¶ disable it
          if (currentRow > 0 && !hardMode) {
            document.getElementById('hardModeToggle').disabled = true;
          }

          // æ›´æ–°æ¸¸æˆæ¨¡å¼ä¿¡æ¯
          updateGameModeMessage();

          return true;
        } catch (e) {
          console.error("æ¢å¤æ¸¸æˆçŠ¶æ€å¤±è´¥:", e);
          return false;
        }
      }

      // æ¸…é™¤ä¿å­˜çš„æ¸¸æˆçŠ¶æ€
      function clearGameState() {
        localStorage.removeItem("wordleGameState");
      }

      // æ˜¾ç¤ºæ¨¡æ€æ¡†
      function showModal(title, message, callback) {
        const modal = document.getElementById("modal");
        const modalTitle = document.getElementById("modal-title");
        const modalMessage = document.getElementById("modal-message");
        const modalOkButton = document.getElementById("modal-ok-button");
        const closeBtn = document.querySelector(".close");

        modalTitle.textContent = title;
        modalMessage.innerHTML = message;

        // ç‚¹å‡»ç¡®å®šæŒ‰é’®
        modalOkButton.onclick = function() {
          modal.style.display = "none";
          if (callback) callback();
        };

        // ç‚¹å‡»å…³é—­æŒ‰é’®
        closeBtn.onclick = function() {
          modal.style.display = "none";
          if (callback) callback();
        };

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        window.onclick = function(event) {
          if (event.target == modal) {
            modal.style.display = "none";
            if (callback) callback();
          }
        };

        // æ˜¾ç¤ºæ¨¡æ€æ¡†
        modal.style.display = "block";
      }

      // æ£€æŸ¥å¹¶æ˜¾ç¤ºæ¸¸æˆç©æ³•æç¤º
      function checkAndShowGameGuide() {
        // æ£€æŸ¥æ˜¯å¦å·²ç»æ˜¾ç¤ºè¿‡æ¸¸æˆæŒ‡å—
        const hasShownGuide = localStorage.getItem("wordleHasShownGuide");
        
        if (!hasShownGuide) {

            showModal("WELCOME TO ANYWORDLE!", 
              "HOW TO PLAY:<br><br>" +
              "1. GUESS THE HIDDEN WORD<br>" +
              "2. EACH GUESS MUST BE A VALID WORD.<br>" +
              "3. AFTER EACH GUESS, THE COLOR OF THE TILES WILL CHANGE TO SHOW HOW CLOSE YOUR GUESS WAS TO THE WORD.<br><br>" +
              "TILE COLORS:<br>" +
              "- ğŸŸ©: LETTER IS IN THE WORD AND IN THE CORRECT POSITION<br>" +
              "- ğŸŸ¨: LETTER IS IN THE WORD BUT IN THE WRONG POSITION<br>" +
              "- â¬›ï¸: LETTER IS NOT IN THE WORD<br>" +
              "- ğŸŸ¥: LETTER IS OUT OF BOUNDS OF AND NOT IN THE WORD<br><br>" +
              "GOOD LUCK!", 
              null);
          }
          // æ ‡è®°å·²ç»æ˜¾ç¤ºè¿‡æ¸¸æˆæŒ‡å—
          localStorage.setItem("wordleHasShownGuide", "true");
        }
      

      // åˆå§‹åŒ–æ¸¸æˆ
      async function initGame() {
        // æ£€æŸ¥æ˜¯å¦é¦–æ¬¡è¿›å…¥æ¸¸æˆï¼Œå¦‚æœæ˜¯åˆ™æ˜¾ç¤ºç©æ³•æç¤º
        checkAndShowGameGuide();

        // åˆå§‹åŒ–hardModeå¤é€‰æ¡†
        const hardModeToggle = document.getElementById('hardModeToggle');
        hardModeToggle.checked = hardMode;
        hardModeToggle.addEventListener('change', function() {
          // å¦‚æœå½“å‰åœ¨ç¬¬ä¸€è¡Œï¼Œå¯ä»¥éšæ„åˆ‡æ¢hard mode
          if (currentRow === 0) {
            hardMode = this.checked;
            saveGameState(); // ä¿å­˜æ¸¸æˆçŠ¶æ€
          } else {
            // å¦‚æœä¸åœ¨ç¬¬ä¸€è¡Œï¼Œåªèƒ½å…³é—­hard modeï¼Œä¸èƒ½å¼€å¯
            if (hardMode && !this.checked) {
              // å…è®¸å…³é—­hard mode
              hardMode = false;
              saveGameState(); // ä¿å­˜æ¸¸æˆçŠ¶æ€
              // å½“åœ¨ç¬¬äºŒè¡Œæˆ–ä¹‹åå…³é—­hard modeæ—¶ï¼Œç¦ç”¨å¤é€‰æ¡†
              if (currentRow >= 1) {
                this.disabled = true;
              }
            } else if (!hardMode && this.checked) {
              // ä¸å…è®¸åœ¨éç¬¬ä¸€è¡Œå¼€å¯hard mode
              this.checked = false;
              showMessage("HARD MODE CAN ONLY BE ENABLED ON THE FIRST ROW", "hint");
            }
            // å¦‚æœå·²ç»æ˜¯å¼€å¯çŠ¶æ€ä¸”å°è¯•ä¿æŒå¼€å¯çŠ¶æ€ï¼Œåˆ™ä¸åšä»»ä½•æ“ä½œ
          }
        });

        // ä¼˜å…ˆåŠ è½½å•è¯åº“
        if (!wordsLoaded) {
          // ä»ä¸¤ä¸ªæ–‡ä»¶å¹¶è¡ŒåŠ è½½å•è¯
          const [common, all] = await Promise.all([
            loadWordsFromFile(COMMON_WORDS_FILE),
            loadWordsFromFile(ALL_WORDS_FILE),
          ]);

          commonWords = common;
          allWords = all;
          wordsLoaded = true;

          // å¦‚æœä»»ä¸€è¯åº“ä¸ºç©ºï¼Œæ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
          if (commonWords.length === 0 || allWords.length === 0) {
            showMessage(
              "FAILED TO LOAD WORD LIST, PLEASE CHECK FILE FORMAT",
              "lose"
            );
            return;
          }
        }

        // æ£€æŸ¥URLå‚æ•°ä¸­æ˜¯å¦æœ‰puzzleå‚æ•°å’Œæ—¥æœŸå‚æ•°
        const urlParams = new URLSearchParams(window.location.search);

        // åˆ¤æ–­æ˜¯å¦å­˜åœ¨URLå‚æ•°
        const hasUrlParams = urlParams.has("p") || urlParams.has("d");

        // å¦‚æœæ²¡æœ‰URLå‚æ•°ï¼Œæ‰å°è¯•æ¢å¤ä¿å­˜çš„çŠ¶æ€
        if (!hasUrlParams) {
          const hasRestoredState = restoreGameState();
          if (hasRestoredState) {
            // å¦‚æœæˆåŠŸæ¢å¤äº†çŠ¶æ€ï¼Œé‡æ–°ç»‘å®šäº‹ä»¶å¹¶è¿”å›
            document.addEventListener("keydown", handleKeyPress);
            document.querySelectorAll(".key").forEach((key) => {
              key.addEventListener("click", () => {
                handleVirtualKeyPress(key.dataset.key);
              });
            });
            return;
          }
        }
        const puzzleParam = urlParams.get("p");
        const dateParam = urlParams.get("d");

        // å¦‚æœæœ‰æ—¥æœŸå‚æ•°ï¼Œä¼˜å…ˆä½¿ç”¨æ—¥æœŸå‚æ•°ï¼ˆå¿½ç•¥æ¯æ—¥è°œé¢˜æ˜¯å¦å®Œæˆçš„æ£€æŸ¥ï¼‰
        if (dateParam) {
          dailyPuzzleDate = dateParam;
          isDailyPuzzle = true;
          targetWord = getDailyPuzzleAnswer(dateParam, commonWords);
          if (puzzleParam) {
          const unscrambledWord = caesarDecipher(puzzleParam, 3); // ä½¿ç”¨ä½ç§»3çš„å‡¯æ’’å¯†ç è§£å¯†
          if (unscrambledWord && unscrambledWord.match(/^[A-Z]+$/)) {
            targetWord = unscrambledWord;
            // console.log('ç›®æ ‡å•è¯(æ¥è‡ªé“¾æ¥):', targetWord);
          } else {
            console.error("Invalid puzzle parameter in URL");
          }
          // console.log('ç›®æ ‡å•è¯(æ¥è‡ªæ—¥æœŸ):', targetWord);
        }}
        // å¦åˆ™ï¼Œå¦‚æœæœ‰puzzleå‚æ•°ï¼Œåˆ™ä½¿ç”¨è¯¥å‚æ•°ä½œä¸ºç›®æ ‡å•è¯
        else if (puzzleParam) {
          const unscrambledWord = caesarDecipher(puzzleParam, 3); // ä½¿ç”¨ä½ç§»3çš„å‡¯æ’’å¯†ç è§£å¯†
          if (unscrambledWord && unscrambledWord.match(/^[A-Z]+$/)) {
            targetWord = unscrambledWord;
            isDailyPuzzle = false; // æ ‡è®°ä¸ºéšæœºè°œé¢˜æ¨¡å¼
            // console.log('ç›®æ ‡å•è¯(æ¥è‡ªé“¾æ¥):', targetWord);
          } else {
            console.error("Invalid puzzle parameter in URL");
          }
        }

        // æ£€æŸ¥æ˜¯å¦å·²å®Œæˆå½“æ—¥è°œé¢˜ï¼ˆä»…åœ¨æ²¡æœ‰é€šè¿‡URLæŒ‡å®šå•è¯æ—¶ï¼‰
        if (!targetWord) {
          if (!dailyPuzzleDate) {
            // å¦‚æœæ—¥æœŸè¿˜æœªè®¾ç½®ï¼ˆæ²¡æœ‰æ—¥æœŸå‚æ•°çš„æƒ…å†µï¼‰
            dailyPuzzleDate = getCurrentUTC8Date();
          }
          puzzleCompleted = isPuzzleCompletedForToday();

          // é»˜è®¤ä½¿ç”¨æ¯æ—¥è°œé¢˜ï¼ˆä»…åœ¨æ²¡æœ‰é€šè¿‡URLæŒ‡å®šå•è¯æ—¶ï¼‰
          isDailyPuzzle = true;

          // é€‰æ‹©ç›®æ ‡å•è¯
          if (isDailyPuzzle && !puzzleCompleted) {
            // ä½¿ç”¨æ¯æ—¥è°œé¢˜ç­”æ¡ˆ
            targetWord = getDailyPuzzleAnswer(dailyPuzzleDate, commonWords);
          } else {
            // ä½¿ç”¨éšæœºè°œé¢˜ç­”æ¡ˆæˆ–åœ¨æ¯æ—¥è°œé¢˜å®Œæˆåä½¿ç”¨éšæœºè°œé¢˜
            targetWord =
              commonWords[Math.floor(Math.random() * commonWords.length)];
            isDailyPuzzle = false; // æ ‡è®°ä¸ºéšæœºè°œé¢˜æ¨¡å¼
          }
        }

        // console.log('ç›®æ ‡å•è¯:', targetWord); // ç”¨äºè°ƒè¯•

        // åˆ›å»ºæ¸¸æˆæ¿
        createBoard();

        // æ˜¾ç¤ºæ¸¸æˆæ¨¡å¼ä¿¡æ¯
        updateGameModeMessage();

        // ç»‘å®šäº‹ä»¶
        document.addEventListener("keydown", handleKeyPress);

        // ç»‘å®šè™šæ‹Ÿé”®ç›˜äº‹ä»¶
        document.querySelectorAll(".key").forEach((key) => {
          key.addEventListener("click", () => {
            handleVirtualKeyPress(key.dataset.key);
          });
        });
      }

      // æ›´æ–°æ¸¸æˆæ¨¡å¼æç¤ºä¿¡æ¯
      function updateGameModeMessage() {
        const dateStr = dailyPuzzleDate;
        if (isDailyPuzzle) {
          if (puzzleCompleted) {
            showMessage(`DAILY PUZZLE ${dailyPuzzleDate} (COMPLETED)`, "win");
          } else {
            showMessage(`DAILY PUZZLE ${dailyPuzzleDate}`, "win");
          }
        } else {
          showMessage("RANDOM PUZZLE", "win");
        }
      }

      // åˆ‡æ¢æ¸¸æˆæ¨¡å¼
      function toggleGameMode() {
        if (isDailyPuzzle && puzzleCompleted) {
          showMessage("YOU'VE ALREADY COMPLETED TODAY'S PUZZLE!", "lose");
          return;
        }

        isDailyPuzzle = !isDailyPuzzle;
        restartGame();
      }

      // åˆ›å»ºæ¸¸æˆæ¿
      function createBoard() {
        const board = document.getElementById("board");
        board.innerHTML = "";

        for (let i = 0; i < maxGuesses; i++) {
          const row = document.createElement("div");
          row.classList.add("row");
          row.id = `row-${i}`;

          // åˆå§‹åªæ˜¾ç¤ºç¬¬ä¸€ä¸ªæ ¼å­
          const tile = document.createElement("div");
          tile.classList.add("tile");
          tile.id = `tile-${i}-0`;
          row.appendChild(tile);

          // è®¾ç½®åˆå§‹ç½‘æ ¼å¸ƒå±€
          row.style.gridTemplateColumns = "repeat(1, 1fr)";

          board.appendChild(row);
        }

        // é‡ç½®å½“å‰è¡Œå’Œå½“å‰æ ¼å­è®¡æ•°å™¨
        currentRow = 0;
        currentTile = 0;
      }

      // å¤„ç†ç‰©ç†é”®ç›˜è¾“å…¥
      function handleKeyPress(e) {
        if (gameOver || isAnimating) return; // æ·»åŠ å¯¹åŠ¨ç”»çŠ¶æ€çš„æ£€æŸ¥

        const key = e.key.toUpperCase();
        // å¤„ç†ç²˜è´´æ“ä½œ
        if (e.ctrlKey && key === "V") {
          handlePaste();
        }
        // å¤„ç†å­—æ¯è¾“å…¥
        else if (/^[A-Z]$/.test(key)) {
          // å¦‚æœå¯ç”¨äº†hardModeï¼Œæ£€æŸ¥å­—æ¯æ˜¯å¦å¯ç”¨
          if (hardMode) {
            const keyElement = document.querySelector(`.key[data-key="${key}"]`);
            // å¦‚æœå­—æ¯è¢«æ ‡è®°ä¸ºabsentï¼ˆç°è‰²ï¼‰ï¼Œåˆ™ä¸å…è®¸è¾“å…¥
            if (keyElement && keyElement.classList.contains('absent')) {
              showMessage("HARD MODE: CANNOT USE LETTERS MARKED GRAY", "lose");
              return;
            }
          }
          addLetter(key);
        }
        // å¤„ç†é€€æ ¼é”®
        else if (key === "BACKSPACE") {
          removeLetter();
        }
        // å¤„ç†å›è½¦é”®
        else if (key === "ENTER" && currentTile >= 1) {
          // è‡³å°‘è¾“å…¥ä¸€ä¸ªå­—æ¯å³å¯æäº¤
          e.preventDefault(); // é˜»æ­¢é»˜è®¤çš„å›è½¦è¡Œä¸º
          submitGuess();
        }
      }

      // å¤„ç†ç²˜è´´æ“ä½œ
      async function handlePaste() {
        try {
          const text = await navigator.clipboard.readText();
          const letters = text.toUpperCase().replace(/[^A-Z]/g, "");

          // æ·»åŠ æ¯ä¸ªå­—æ¯
          for (const letter of letters) {
            if (/^[A-Z]$/.test(letter)) {
              addLetter(letter);
              // æ·»åŠ å°å»¶è¿Ÿä»¥è·å¾—æ›´å¥½çš„è§†è§‰æ•ˆæœ
              await new Promise((resolve) => setTimeout(resolve, 50));
            }
          }
        } catch (err) {
          console.error("ç²˜è´´æ“ä½œå¤±è´¥:", err);
        }
      }

      // å¤„ç†è™šæ‹Ÿé”®ç›˜è¾“å…¥
      function handleVirtualKeyPress(key) {
        if (gameOver || isAnimating) return; // æ·»åŠ å¯¹åŠ¨ç”»çŠ¶æ€çš„æ£€æŸ¥

        if (key === "Enter") {
          if (currentTile >= 1) {
            // è‡³å°‘è¾“å…¥ä¸€ä¸ªå­—æ¯å³å¯æäº¤
            submitGuess();
          }
        } else if (key === "Backspace") {
          if (currentTile > 0) {
            removeLetter();
          }
        } else {
          if (/^[A-Z]$/.test(key)) {
            // å¦‚æœå¯ç”¨äº†hardModeï¼Œæ£€æŸ¥å­—æ¯æ˜¯å¦å¯ç”¨
            if (hardMode) {
              const keyElement = document.querySelector(`.key[data-key="${key}"]`);
              // å¦‚æœå­—æ¯è¢«æ ‡è®°ä¸ºabsentï¼ˆç°è‰²ï¼‰ï¼Œåˆ™ä¸å…è®¸è¾“å…¥
              if (keyElement && keyElement.classList.contains('absent')) {
                showMessage("HARD MODE: CANNOT USE LETTERS MARKED GRAY", "lose");
                return;
              }
            }
            addLetter(key);
          }
        }
      }

      // æ·»åŠ å­—æ¯åˆ°å½“å‰æ ¼å­
      function addLetter(letter) {
        // å¦‚æœæ¸¸æˆå·²ç»ç»“æŸæˆ–è€…æ­£åœ¨æ’­æ”¾åŠ¨ç”»ï¼Œåˆ™ä¸å¤„ç†è¾“å…¥
        if (gameOver || isAnimating) return;

        const row = document.getElementById(`row-${currentRow}`);

        // å¦‚æœæ‰¾ä¸åˆ°å¯¹åº”çš„è¡Œå…ƒç´ ï¼Œåˆ™ä¸å¤„ç†è¾“å…¥
        if (!row) return;

        // ç¡®ä¿å½“å‰æ ¼å­å­˜åœ¨
        if (currentTile >= row.children.length) {
          const tile = document.createElement("div");
          tile.classList.add("tile");
          tile.id = `tile-${currentRow}-${row.children.length}`;
          row.appendChild(tile);
        }

        // è·å–å½“å‰æ ¼å­å¹¶å¡«å……å­—æ¯
        const tile = document.getElementById(
          `tile-${currentRow}-${currentTile}`
        );
        tile.innerHTML = letter;
        tile.classList.add("filled");

        // å¢åŠ ä¸€ä¸ªç©ºæ ¼å­ç”¨äºæç¤º
        if (currentTile + 1 >= row.children.length) {
          const newTile = document.createElement("div");
          newTile.classList.add("tile");
          newTile.id = `tile-${currentRow}-${row.children.length}`;
          row.appendChild(newTile);

          // æ›´æ–°ç½‘æ ¼å¸ƒå±€
          row.style.gridTemplateColumns = `repeat(${row.children.length}, 1fr)`;
        }

        currentTile++;

        // ä¿å­˜æ¸¸æˆçŠ¶æ€
        saveGameState();
      }

      // åˆ é™¤å½“å‰è¡Œçš„æœ€åä¸€ä¸ªå­—æ¯
      function removeLetter() {
        if (currentTile > 0) {
          currentTile--;
          const tile = document.getElementById(
            `tile-${currentRow}-${currentTile}`
          );
          tile.innerHTML = "";
          tile.classList.remove("filled");
        }
        // ç§»é™¤å½“å‰è¡Œæœ€åä¸€ä¸ªç©ºæ ¼å­
        removeEmptyTile();

        // ä¿å­˜æ¸¸æˆçŠ¶æ€
        saveGameState();
      }

      // ç§»é™¤å½“å‰è¡Œæœ€åä¸€ä¸ªç©ºæ ¼å­
      function removeEmptyTile() {
        const row = document.getElementById(`row-${currentRow}`);

        // å¦‚æœæœ€åä¸€ä¸ªæ ¼å­æ˜¯ç©ºçš„ï¼Œä¸”ä¸æ˜¯å”¯ä¸€çš„æ ¼å­ï¼Œåˆ™ç§»é™¤å®ƒ
        if (row.children.length > currentTile && row.children.length > 1) {
          row.removeChild(row.lastChild);
          // æ›´æ–°ç½‘æ ¼å¸ƒå±€
          row.style.gridTemplateColumns = `repeat(${row.children.length}, 1fr)`;
        }
      }

      // åˆ é™¤æŒ‡å®šè¡Œçš„æ‰€æœ‰ç©ºç™½æ ¼å­ï¼Œåªä¿ç•™æœ‰å­—æ¯çš„æ ¼å­
      function removeEmptyTilesInRow(rowId) {
        const row = document.getElementById(`row-${rowId}`);

        // ä»åå¾€å‰éå†ï¼Œé¿å…åˆ é™¤è¿‡ç¨‹ä¸­ç´¢å¼•å˜åŒ–çš„é—®é¢˜
        for (let i = row.children.length - 1; i >= 0; i--) {
          const tile = row.children[i];
          // å¦‚æœæ ¼å­æ˜¯ç©ºçš„ä¸”ä¸æ˜¯å”¯ä¸€çš„æ ¼å­ï¼Œåˆ™åˆ é™¤å®ƒ
          if (!tile.innerHTML && row.children.length > 1) {
            row.removeChild(tile);
          }
        }

        // å¦‚æœåˆ é™¤äº†æ ¼å­ï¼Œéœ€è¦æ›´æ–°ç½‘æ ¼å¸ƒå±€
        if (row.children.length > 0) {
          row.style.gridTemplateColumns = `repeat(${row.children.length}, 1fr)`;
        }
      }

      // æäº¤çŒœæµ‹
      function submitGuess() {
        // å¦‚æœæ­£åœ¨æ’­æ”¾åŠ¨ç”»ï¼Œä¸å¤„ç†æäº¤
        if (isAnimating) return;

        // è·å–å½“å‰è¡Œçš„å•è¯
        let guess = "";
        const row = document.getElementById(`row-${currentRow}`);

        // åªæ”¶é›†å·²å¡«å……çš„æ ¼å­å†…å®¹
        for (let i = 0; i < currentTile; i++) {
          const tile = document.getElementById(`tile-${currentRow}-${i}`);
          if (tile && tile.innerHTML) {
            guess += tile.innerHTML;
          }
        }

        // æ£€æŸ¥å•è¯æ˜¯å¦åœ¨å…¨éƒ¨è¯åº“ä¸­
        if (
          !allWords.includes(guess) &&
          !commonWords.includes(guess) &&
          targetWord !== guess
        ) {
          const cambridgeLink = `https://dictionary.cambridge.org/dictionary/english/${guess.toLowerCase()}`;
          showMessage(
            `WORD NOT IN WORD LIST! CHECK <a href="${cambridgeLink}" target="_blank">${guess}</a> ON CAMBRIDGE DICTIONARY.`,
            "lose"
          );
          // æŠ–åŠ¨æ•ˆæœ
          row.style.animation = "shake 0.5s";
          setTimeout(() => {
            row.style.animation = "";
          }, 500);
          return;
        }

        // æ£€æŸ¥ç»“æœ
        checkGuess(guess);
      }

      // æ£€æŸ¥çŒœæµ‹ç»“æœ
      function checkGuess(guess) {
        // è®¾ç½®åŠ¨ç”»çŠ¶æ€
        isAnimating = true;

        // å½“ç¬¬äºŒè¡Œhardmodeæœªå¼€å¯æ—¶ disable it
        if (currentRow >= 1 && !hardMode) {
          document.getElementById('hardModeToggle').disabled = true;
        }

        // åˆ›å»ºç›®æ ‡å•è¯å­—æ¯è®¡æ•°
        const targetCounts = {};
        for (let i = 0; i < targetWord.length; i++) {
          const char = targetWord[i];
          targetCounts[char] = (targetCounts[char] || 0) + 1;
        }

        // ç¬¬1è½®ï¼šæ ‡è®°æ­£ç¡®ä½ç½®çš„å­—æ¯ï¼ˆç»¿è‰²ï¼‰
        const result = Array(guess.length).fill(null);
        for (let i = 0; i < Math.min(guess.length, targetWord.length); i++) {
          if (guess[i] === targetWord[i]) {
            result[i] = "correct";
            targetCounts[guess[i]]--;
          }
        }

        // ç¬¬2è½®ï¼šæ ‡è®°å­˜åœ¨ä½†ä½ç½®é”™è¯¯çš„å­—æ¯ï¼ˆé»„è‰²ï¼‰
        for (let i = 0; i < guess.length; i++) {
          if (result[i] === null) {
            if (targetCounts[guess[i]] > 0) {
              result[i] = "present";
              targetCounts[guess[i]]--;
            }
          }
        }

        // ç¬¬3è½®ï¼šæ ‡è®°å‰©ä½™çš„å­—æ¯ï¼ˆç°è‰²æˆ–çº¢è‰²ï¼‰
        for (let i = 0; i < guess.length; i++) {
          if (result[i] === null) {
            if (i >= targetWord.length) {
              result[i] = "invalid"; // è¶…å‡ºé•¿åº¦çš„å­—æ¯æ ‡è®°ä¸ºçº¢è‰²
            } else {
              result[i] = "absent"; // å…¶ä»–æœªæ ‡è®°çš„å­—æ¯æ ‡è®°ä¸ºç°è‰²
            }
          }
        }

        // æ˜¾ç¤ºç»“æœ
        let correctCount = 0;
        // æ·»åŠ åŠ¨ç”»å®Œæˆè®¡æ•°å™¨
        let animationCount = 0;

        // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰å­—æ¯éƒ½æ˜¯ç»¿è‰²ä¸”é•¿åº¦å°äºç›®æ ‡è¯
        const allGreen = result.every((r) => r === "correct");
        const needsQuestionMark = allGreen && guess.length < targetWord.length;

        // åŒæ—¶æ˜¾ç¤ºæ‰€æœ‰æ ¼å­çš„ç»“æœï¼Œä½†è¦ç­‰å¾…åŠ¨ç”»å®Œæˆ
        for (let i = 0; i < result.length; i++) {
          const tile = document.getElementById(`tile-${currentRow}-${i}`);
          if (result[i]) {
            tile.classList.add(result[i], "flip");
            // ç›‘å¬åŠ¨ç”»å®Œæˆ
            tile.addEventListener(
              "animationend",
              () => {
                animationCount++;
                if (
                  animationCount ===
                  result.length + (needsQuestionMark ? 1 : 0)
                ) {
                  // æ‰€æœ‰åŠ¨ç”»å®Œæˆåï¼Œé‡ç½®åŠ¨ç”»çŠ¶æ€
                  isAnimating = false;
                }
              },
              { once: true }
            ); // ç¡®ä¿äº‹ä»¶ç›‘å¬å™¨åªè§¦å‘ä¸€æ¬¡
          }

          // æ›´æ–°è™šæ‹Ÿé”®ç›˜çŠ¶æ€ - ä¿®å¤é¢œè‰²æ›´æ–°é€»è¾‘
          const keyElement = document.querySelector(
            `.key[data-key="${guess[i]}"]`
          );
          if (guess[i] && keyElement) {
            // å®šä¹‰ä¼˜å…ˆçº§é¡ºåº
            const priority = {
              correct: 3,
              present: 2,
              absent: 1,
              invalid: 1,
            };

            // è·å–å½“å‰çŠ¶æ€çš„ä¼˜å…ˆçº§
            const currentState = keyElement.classList.contains("correct")
              ? "correct"
              : keyElement.classList.contains("present")
              ? "present"
              : keyElement.classList.contains("absent")
              ? "absent"
              : null;

            const currentPriority = currentState ? priority[currentState] : 0;
            const newPriority = priority[result[i]];

            // åªæœ‰å½“æ–°çŠ¶æ€ä¼˜å…ˆçº§æ›´é«˜æ—¶æ‰æ›´æ–°
            if (newPriority > currentPriority) {
              // ç§»é™¤æ‰€æœ‰çŠ¶æ€ç±»
              keyElement.classList.remove("correct", "present", "absent");
              // æ·»åŠ æ–°çŠ¶æ€ç±»
              keyElement.classList.add(
                result[i] === "invalid" ? "absent" : result[i]
              );
            }
          }

          if (result[i] === "correct") {
            correctCount++;
          }
        }

        // å¦‚æœéœ€è¦æ·»åŠ é—®å·ï¼Œåˆ›å»ºæ–°çš„é—®å·æ ¼å­
        if (needsQuestionMark) {
          const lastIndex = result.length;
          const tile = document.createElement("div");
          tile.classList.add("tile", "absent", "flip");
          tile.id = `tile-${currentRow}-${lastIndex}`;
          tile.innerHTML = "?";
          const row = document.getElementById(`row-${currentRow}`);
          row.appendChild(tile);

          // æ›´æ–°è¡Œçš„ç½‘æ ¼å¸ƒå±€ä»¥åŒ…å«æ–°çš„é—®å·æ ¼å­
          row.style.gridTemplateColumns = `repeat(${result.length + 1}, 1fr)`;

          // ç›‘å¬é—®å·æ ¼å­çš„åŠ¨ç”»å®Œæˆ
          tile.addEventListener(
            "animationend",
            () => {
              animationCount++;
              if (animationCount === result.length + 1) {
                isAnimating = false;
              }
            },
            { once: true }
          );
        }

        // åˆ é™¤å½“å‰è¡Œçš„ç©ºç™½æ ¼å­
        removeEmptyTilesInRow(currentRow);

        // æ£€æŸ¥æ˜¯å¦èƒœåˆ©
        if (guess === targetWord) {
          const modeText = isDailyPuzzle
            ? `DAILY PUZZLE ${dailyPuzzleDate}`
            : "RANDOM PUZZLE";
          const cambridgeLink = `https://dictionary.cambridge.org/dictionary/english/${targetWord.toLowerCase()}`;

          gameOver = true;
          // æ·»åŠ çº¸ç‰‡çƒŸèŠ±ç‰¹æ•ˆ
          if (currentRow < recommendGuesses) {
            createConfetti();
            showMessage(
              `CONGRATULATIONS! YOU GUESSED IT! THE WORD IS: <a href="${cambridgeLink}" target="_blank">${targetWord}</a> [${modeText}]`,
              "win"
            );
          }else {
            showMessage(
              `YOU GUESSED IT! THE WORD IS: <a href="${cambridgeLink}" target="_blank">${targetWord}</a> [${modeText}]`,
              "win"
            );
          }
          // æ·»åŠ åˆ†äº«æŒ‰é’®
          addSharePuzzleButton();
          // åªæœ‰å½“æ˜¯æ¯æ—¥è°œé¢˜ä¸”æ—¥æœŸæ˜¯å½“å¤©æ—¶ï¼Œæ‰è®°å½•å®ŒæˆçŠ¶æ€
          if (isDailyPuzzle && dailyPuzzleDate === getCurrentUTC8Date()) {
            recordPuzzleCompletion();
          }
          // æ¸…é™¤ä¿å­˜çš„æ¸¸æˆçŠ¶æ€ï¼Œå› ä¸ºæ¸¸æˆå·²ç»ç»“æŸ
          clearGameState();
          isAnimating = false;
          // æ›´æ–°æŒ‰é’®çŠ¶æ€
          updateActionButton();
          return;
        }

        // æ£€æŸ¥æ˜¯å¦ç”¨å°½æ‰€æœ‰æœºä¼š
        if (currentRow >= maxGuesses - 1) {
          // è¶…å‡ºæ¨èæ¬¡æ•°ï¼Œè‡ªåŠ¨åˆ›å»ºæ–°è¡Œ
          maxGuesses++;
          const newRow = document.createElement("div");
          newRow.classList.add("row");
          newRow.id = `row-${maxGuesses - 1}`;

          // åˆå§‹åªæ˜¾ç¤ºç¬¬ä¸€ä¸ªæ ¼å­
          const newTile = document.createElement("div");
          newTile.classList.add("tile");
          newTile.id = `tile-${maxGuesses - 1}-0`;
          newRow.appendChild(newTile);

          // è®¾ç½®åˆå§‹ç½‘æ ¼å¸ƒå±€
          newRow.style.gridTemplateColumns = "repeat(1, 1fr)";

          document.getElementById("board").appendChild(newRow);
        }

        // å‡†å¤‡ä¸‹ä¸€è¡Œ
        currentRow++;
        currentTile = 0;
        isAnimating = false;

        // å½“ç¬¬äºŒè¡Œhardmodeæœªå¼€å¯æ—¶ disable it
        if (currentRow > 0 && !hardMode) {
          document.getElementById('hardModeToggle').disabled = true;
        }

        // ä¿å­˜æ¸¸æˆçŠ¶æ€
        saveGameState();
      }

      // ç”Ÿæˆéšæœºè°œé¢˜åˆ†äº«é“¾æ¥å¹¶åˆ†äº«æˆ–å¤åˆ¶åˆ°å‰ªè´´æ¿
      function copyPuzzleLinkToClipboard() {
        // åˆ›å»ºé“¾æ¥ï¼Œæ¯æ—¥è°œé¢˜éœ€è¦æ—¥æœŸï¼Œéšæœºè°œé¢˜éœ€è¦ä½¿ç”¨å‡¯æ’’å¯†ç æ··æ·†å•è¯
        let url;
        let scrambledWord = caesarCipher(targetWord, 3); // ä½¿ç”¨ä½ç§»3çš„å‡¯æ’’å¯†ç 
        if (isDailyPuzzle) {
          url = `${window.location.origin}${window.location.pathname}?p=${scrambledWord}&d=${dailyPuzzleDate}`;
        } else {
          url = `${window.location.origin}${window.location.pathname}?p=${scrambledWord}`;
        }

        // ç”Ÿæˆemojiç½‘æ ¼
        let emojiGrid = `#ANYWORDLE ${isDailyPuzzle ? dailyPuzzleDate : ""}${hardMode ? " HARD!" : ""}\n`;

        for (let i = 0; i <= currentRow; i++) {
          const row = document.getElementById(`row-${i}`);
          let rowEmojis = "";

          // æ”¶é›†æ‰€æœ‰æ ¼å­çš„ç»“æœ
          for (let j = 0; j < row.children.length; j++) {
            const tile = document.getElementById(`tile-${i}-${j}`);
            if (tile && tile.innerHTML) {
              if (tile.classList.contains("correct")) {
                rowEmojis += "ğŸŸ©";
              } else if (tile.classList.contains("present")) {
                rowEmojis += "ğŸŸ¨";
              } else if (tile.classList.contains("invalid")) {
                rowEmojis += "ğŸŸ¥";
              } else if (tile.classList.contains("absent")) {
                rowEmojis += "â¬›ï¸";
              } else {
                break;
              }
            }
          }

          if (rowEmojis) {
            emojiGrid += rowEmojis + "\n";
          }
        }

        // æ·»åŠ ç½‘å€å’Œåˆ†äº«é“¾æ¥
        emojiGrid += `${url}`;

        // æ€»æ˜¯å…ˆå°è¯•å¤åˆ¶åˆ°å‰ªè´´æ¿
        navigator.clipboard
          .writeText(emojiGrid)
          .then(() => {
              const originalText = document.getElementById("message").innerHTML;
              showMessage("EMOJI COPIED TO CLIPBOARD!", "win");
              showModal("EMOJI COPIED TO CLIPBOARD!", "<textarea>"+emojiGrid+"</textarea>", null);
            }
          )
          .catch((err) => {
            console.error("Operation failed:", err);

          });
      }

      // å‡¯æ’’å¯†ç åŠ å¯†
      function caesarCipher(str, shift) {
        return str.replace(/[A-Z]/g, (char) => {
          const code = char.charCodeAt(0);
          // å°†å­—ç¬¦æŒ‰æŒ‡å®šåç§»é‡ç§»åŠ¨
          const shifted = ((code - 65 + shift) % 26) + 65;
          return String.fromCharCode(shifted);
        });
      }

      // å‡¯æ’’å¯†ç è§£å¯†
      function caesarDecipher(str, shift) {
        return str.replace(/[A-Z]/g, (char) => {
          const code = char.charCodeAt(0);
          // åå‘ç§»åŠ¨å­—ç¬¦
          const shifted = ((code - 65 - shift + 26) % 26) + 65;
          return String.fromCharCode(shifted);
        });
      }

      // å‡ºé¢˜
      function generatePuzzle(puzzleWord) {
        var p = caesarCipher(puzzleWord.toUpperCase(), 3); // ä½¿ç”¨å‡¯æ’’å¯†ç åŠ å¯†
        console.log(
          `${window.location.origin}${window.location.pathname}?p=` + p
        );
      }

      // æ˜¾ç¤ºæ¶ˆæ¯
      function showMessage(text, className = "") {
        const messageElement = document.getElementById("message");
        messageElement.innerHTML = text;
        messageElement.className = "message " + className;
      }

      // ä»æ–‡ä»¶åŠ è½½å•è¯åº“
      async function loadWordsFromFile(filePath) {
        try {
          showMessage("LOADING DICTIONARY...", "hint");
          const response = await fetch(filePath);
          if (!response.ok) {
            throw new Error(`Unable to load file: ${filePath}`);
          }
          const text = await response.text();
          // æŒ‰è¡Œåˆ†å‰²å¹¶æ¸…ç†æ•°æ®ï¼ˆå»é™¤ç©ºè¡Œå’Œç©ºç™½å­—ç¬¦ï¼Œè½¬æ¢ä¸ºå¤§å†™ï¼‰
          return text
            .split("\n")
            .map((word) => word.trim().toUpperCase())
            .filter((word) => word.length > 0);
        } catch (error) {
          console.error(error);
          showMessage(`FAILED TO LOAD WORD LIST: ${filePath}`, "lose");
          return []; // è¿”å›ç©ºæ•°ç»„ä½œä¸ºåå¤‡
        }
      }

      // è·å–å½“å‰UTC+8æ—¥æœŸå­—ç¬¦ä¸² (YYYY-MM-DD)
      function getCurrentUTC8Date() {
        const now = new Date();
        // è½¬æ¢ä¸ºUTC+8æ—¶é—´
        const utc8Time = new Date(now.getTime() + 8 * 60 * 60 * 1000);
        const year = utc8Time.getUTCFullYear();
        const month = String(utc8Time.getUTCMonth() + 1).padStart(2, "0");
        const day = String(utc8Time.getUTCDate()).padStart(2, "0");
        return `${year}-${month}-${day}`;
      }

      // æ£€æŸ¥å½“æ—¥è°œé¢˜éšæœºæ˜¯å¦å·²å®Œæˆ
      function isPuzzleCompletedForToday() {
        const today = getCurrentUTC8Date();
        const lastCompleted = localStorage.getItem("wordleLastCompleted");
        const lastPuzzleDate = localStorage.getItem("wordlePuzzleDate");

        // å¦‚æœä¸Šæ¬¡å®Œæˆçš„æ—¥æœŸä¸å½“å‰æ—¥æœŸç›¸åŒï¼Œåˆ™å½“æ—¥è°œé¢˜å·²å®Œæˆ
        return lastCompleted && lastPuzzleDate === today;
      }

      // è®°å½•è°œé¢˜å®ŒæˆçŠ¶æ€
      function recordPuzzleCompletion() {
        const today = getCurrentUTC8Date();
        localStorage.setItem("wordleLastCompleted", new Date().toISOString());
        localStorage.setItem("wordlePuzzleDate", today);
      }

      // æ ¹æ®æ—¥æœŸè·å–æ¯æ—¥è°œé¢˜ç­”æ¡ˆ
      function getDailyPuzzleAnswer(dateString, wordList) {
        // ä½¿ç”¨æ›´å‡åŒ€çš„å“ˆå¸Œç®—æ³•æ¥é€‰æ‹©å•è¯
        // è¿™ä¸ªç®—æ³•ç»“åˆäº†å¤šä¸ªæŠ€æœ¯æ¥è·å¾—æ›´å¥½çš„åˆ†å¸ƒ
        let hash = 0;
        const len = dateString.length;

        // ä½¿ç”¨ä¸åŒçš„è´¨æ•°å’Œä½è¿ç®—ç»„åˆæ¥æé«˜éšæœºæ€§
        for (let i = 0; i < len; i++) {
          const char = dateString.charCodeAt(i);
          hash = (hash << 5) - hash + char;
          hash = hash & hash; // è½¬æ¢ä¸º32ä½æ•´æ•°
        }

        // æ·»åŠ ä¸€ä¸ªé¢å¤–çš„æ­¥éª¤æ¥è¿›ä¸€æ­¥æ‰“ä¹±å“ˆå¸Œå€¼
        hash = ((hash >> 16) ^ hash) * 0x45d9f3b;
        hash = ((hash >> 16) ^ hash) * 0x45d9f3b;
        hash = (hash >> 16) ^ hash;

        // ä½¿ç”¨å“ˆå¸Œå€¼é€‰æ‹©å•è¯åˆ—è¡¨ä¸­çš„å•è¯
        const index = Math.abs(hash) % wordList.length;
        return wordList[index];
      }

      // è°ƒè¯•åŠŸèƒ½ï¼šåœ¨æ§åˆ¶å°æŸ¥çœ‹æ¥ä¸‹æ¥10å¤©çš„æ¯æ—¥è°œé¢˜ç­”æ¡ˆ
      function printNext10DaysAnswers() {
        console.log("æ¥ä¸‹æ¥10å¤©çš„æ¯æ—¥è°œé¢˜ç­”æ¡ˆï¼š");

        const today = new Date();
        for (let i = 0; i < 10; i++) {
          // è®¡ç®—æœªæ¥ç¬¬iå¤©çš„æ—¥æœŸ
          const nextDate = new Date(today);
          nextDate.setDate(today.getDate() + i);

          // æ ¼å¼åŒ–ä¸º YYYY-MM-DD å­—ç¬¦ä¸²
          const year = nextDate.getFullYear();
          const month = String(nextDate.getMonth() + 1).padStart(2, "0");
          const day = String(nextDate.getDate()).padStart(2, "0");
          const dateString = `${year}-${month}-${day}`;

          // è·å–è¯¥æ—¥æœŸçš„æ¯æ—¥è°œé¢˜ç­”æ¡ˆ
          const answer = getDailyPuzzleAnswer(dateString, commonWords);
          console.log(`${dateString}: ${answer}`);
        }
      }

      // æ·»åŠ åˆ†äº«æŒ‰é’®
      function addSharePuzzleButton() {
        // å¦‚æœå·²ç»å­˜åœ¨åˆ†äº«æŒ‰é’®ï¼Œå…ˆç§»é™¤å®ƒ
        const existingContainer = document.querySelector(".share-container");
        if (existingContainer) {
          existingContainer.remove();
        }

        // åˆ›å»ºæ–°çš„åˆ†äº«æŒ‰é’®å®¹å™¨
        const shareContainer = document.createElement("div");
        shareContainer.classList.add("share-container");

        // åˆ›å»ºåˆ†äº«æŒ‰é’®
        const shareButton = document.createElement("button");
        shareButton.innerHTML = "SHARE PUZZLE";
        shareButton.classList.add("share");
        shareButton.addEventListener("click", copyPuzzleLinkToClipboard);

        // å°†æŒ‰é’®æ·»åŠ åˆ°å®¹å™¨ä¸­
        shareContainer.appendChild(shareButton);

        // å°†å®¹å™¨æ·»åŠ åˆ°æ¸¸æˆå®¹å™¨ä¸­
        const gameContainer = document.querySelector(".game-container");
        gameContainer.appendChild(shareContainer);
      }

      // é‡æ–°å¼€å§‹æ¸¸æˆ
      function restartGame() {
        // å¦‚æœæ˜¯æ¯æ—¥è°œé¢˜ä¸”æ¸¸æˆæœªç»“æŸï¼Œæ˜¾ç¤ºè­¦å‘Š
        if (isDailyPuzzle && !gameOver) {
          let message = puzzleCompleted
            ? "DAILY PUZZLE ALREADY COMPLETED. START A RANDOM PUZZLE?"
            : "ARE YOU SURE YOU WANT TO SKIP TODAY'S DAILY PUZZLE?";
          const confirmRestart = confirm(message);
          if (!confirmRestart) {
            return;
          } else {
            recordPuzzleCompletion();
          }
        }
        document.getElementById('hardModeToggle').disabled = false;
        
        // ç§»é™¤åˆ†äº«æŒ‰é’®
        const shareContainer = document.querySelector(".share-container");
        if (shareContainer) {
          shareContainer.remove();
        }

        // æ¸…é™¤ä¿å­˜çš„æ¸¸æˆçŠ¶æ€
        clearGameState();

        // åˆ›å»ºæ–°çš„URLå¯¹è±¡
        const url = new URL(window.location);

        // åˆ é™¤på‚æ•°ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
        url.searchParams.delete("p");
        url.searchParams.delete("d");

        // æ›´æ–°æµè§ˆå™¨å†å²è®°å½•ï¼Œä¸é‡æ–°åŠ è½½é¡µé¢
        window.history.replaceState({}, "", url);

        // é‡ç½®æ¸¸æˆçŠ¶æ€
        currentRow = 0;
        currentTile = 0;
        gameOver = false;
        isAnimating = false;
        maxGuesses = recommendGuesses; // é‡ç½®ä¸ºæ¨èçŒœæµ‹æ¬¡æ•°
        hardMode = false; // é‡ç½®hardModeçŠ¶æ€

        // é€‰æ‹©ç›®æ ‡å•è¯ï¼ˆä½¿ç”¨æ¯æ—¥è°œé¢˜ï¼‰
        dailyPuzzleDate = getCurrentUTC8Date();
        puzzleCompleted = isPuzzleCompletedForToday();
        isDailyPuzzle = true;

        if (isDailyPuzzle && !puzzleCompleted) {
          // ä½¿ç”¨æ¯æ—¥è°œé¢˜ç­”æ¡ˆ
          targetWord = getDailyPuzzleAnswer(dailyPuzzleDate, commonWords);
        } else {
          // ä½¿ç”¨éšæœºè°œé¢˜ç­”æ¡ˆæˆ–åœ¨æ¯æ—¥è°œé¢˜å®Œæˆåä½¿ç”¨éšæœºè°œé¢˜
          targetWord =
            commonWords[Math.floor(Math.random() * commonWords.length)];
          isDailyPuzzle = false; // æ ‡è®°ä¸ºéšæœºè°œé¢˜æ¨¡å¼
        }

        // console.log('æ–°ç›®æ ‡å•è¯:', targetWord); // ç”¨äºè°ƒè¯•

        // æ¸…é™¤æ¶ˆæ¯
        showMessage("");

        // é‡æ–°åˆ›å»ºæ¸¸æˆæ¿
        createBoard();

        // æ›´æ–°æ¸¸æˆæ¨¡å¼ä¿¡æ¯
        updateGameModeMessage();

        // é‡ç½®è™šæ‹Ÿé”®ç›˜é¢œè‰²
        document.querySelectorAll(".key").forEach((key) => {
          key.classList.remove("correct", "present", "absent");
          // ç§»é™¤æ‰€æœ‰ç°æœ‰çš„ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨
          const clone = key.cloneNode(true);
          key.parentNode.replaceChild(clone, key);
          // æ·»åŠ æ–°çš„ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨
          clone.addEventListener("click", () => {
            handleVirtualKeyPress(clone.dataset.key);
          });
        });

        // ç§»é™¤åˆ†äº«æŒ‰é’®ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
        const existingContainer = document.querySelector(".share-container");
        if (existingContainer) {
          existingContainer.remove();
        }

        // é‡æ–°ç»‘å®šé”®ç›˜äº‹ä»¶
        document.removeEventListener("keydown", handleKeyPress);
        document.addEventListener("keydown", handleKeyPress);

        // æ›´æ–°æŒ‰é’®çŠ¶æ€
        updateActionButton();
        
        // é‡ç½®hardModeå¤é€‰æ¡†
        document.getElementById('hardModeToggle').checked = false;
      }

      // æ”¾å¼ƒæ¸¸æˆ
      function giveUp() {
        if (!gameOver) {
          const modeText = isDailyPuzzle
            ? `DAILY PUZZLE ${dailyPuzzleDate}`
            : "RANDOM PUZZLE";
          const cambridgeLink = `https://dictionary.cambridge.org/dictionary/english/${targetWord.toLowerCase()}`;
          showMessage(
            `YOU GAVE UP! THE CORRECT ANSWER IS: <a href="${cambridgeLink}" target="_blank">${targetWord}</a> [${modeText}]`,
            "lose"
          );
          gameOver = true;

          // æ”¾å¼ƒæ—¶æ·»åŠ åˆ†äº«æŒ‰é’®
          addSharePuzzleButton();

          // åªæœ‰å½“æ˜¯æ¯æ—¥è°œé¢˜ä¸”æ—¥æœŸæ˜¯å½“å¤©æ—¶ï¼Œæ‰è®°å½•å®ŒæˆçŠ¶æ€
          if (isDailyPuzzle && dailyPuzzleDate === getCurrentUTC8Date()) {
            recordPuzzleCompletion();
          }
          // æ¸…é™¤ä¿å­˜çš„æ¸¸æˆçŠ¶æ€ï¼Œå› ä¸ºæ¸¸æˆå·²ç»ç»“æŸ
          clearGameState();
          // æ›´æ–°æŒ‰é’®çŠ¶æ€
          updateActionButton();
        }
      }

      // çº¸ç‰‡çƒŸèŠ±ç‰¹æ•ˆå‡½æ•°
      function createConfetti() {
        const colors = [
          "#ff0000",
          "#00ff00",
          "#0000ff",
          "#ffff00",
          "#ff00ff",
          "#00ffff",
          "#ff8000",
        ];
        const confettiCount = Math.floor(
          Math.min(targetWord.length * (maxGuesses - currentRow), 200)
        );

        for (let i = 0; i < confettiCount; i++) {
          const confetti = document.createElement("div");
          confetti.className = "confetti";
          confetti.style.backgroundColor =
            colors[Math.floor(Math.random() * colors.length)];
          confetti.style.width = Math.random() * 10 + 5 + "px";
          confetti.style.height = Math.random() * 10 + 5 + "px";
          confetti.style.borderRadius = Math.random() > 0.5 ? "50%" : "0";
          document.body.appendChild(confetti);

          // è®¾ç½®åˆå§‹ä½ç½®ï¼ˆå±å¹•é¡¶éƒ¨ä¸­å¤®ï¼‰
          const startX = window.innerWidth / 2;
          const startY = -10;
          confetti.style.left = startX + "px";
          confetti.style.top = startY + "px";
          confetti.style.opacity = "1";

          // éšæœºç”Ÿæˆè¿åŠ¨å‚æ•°
          const angle = Math.random() * Math.PI * 2;
          const velocity = 2 + Math.random() * 3;
          const velocityX = Math.cos(angle) * velocity * (0.5 + Math.random());
          const velocityY = Math.sin(angle) * velocity * (0.5 + Math.random());
          const gravity = 0.05 + Math.random() * 0.1;
          const rotation = Math.random() * 360;
          const rotationSpeed = -10 + Math.random() * 20;
          const drag = 0.98;

          // åŠ¨ç”»å¾ªç¯
          let x = startX;
          let y = startY;
          let vx = velocityX;
          let vy = velocityY;
          let rot = rotation;

          const animate = () => {
            vy += gravity;
            vx *= drag;
            vy *= drag;

            x += vx;
            y += vy;
            rot += rotationSpeed;

            confetti.style.left = x + "px";
            confetti.style.top = y + "px";
            confetti.style.transform = `rotate(${rot}deg)`;

            // æ£€æŸ¥æ˜¯å¦ä»åœ¨è§†çª—å†…
            if (
              y < window.innerHeight &&
              x > -20 &&
              x < window.innerWidth + 20
            ) {
              requestAnimationFrame(animate);
            } else {
              // ç§»é™¤çº¸ç‰‡
              confetti.remove();
            }
          };

          // å¼€å§‹åŠ¨ç”»
          requestAnimationFrame(animate);
        }
      }

      // åˆå§‹åŒ–æ¸¸æˆ
      window.onload = async function () {
        // åˆå§‹åŒ–æ¸¸æˆ
        await initGame();

        // åœ¨æ§åˆ¶å°æ‰“å°æ¥ä¸‹æ¥10å¤©çš„æ¯æ—¥è°œé¢˜ç­”æ¡ˆ
        // printNext10DaysAnswers();

        // æ·»åŠ ç»„åˆæŒ‰é’®ï¼ˆGive Up/Restartï¼‰
        const actionButton = document.createElement("button");
        actionButton.id = "actionButton";
        actionButton.innerHTML = "GIVE UP";
        actionButton.classList.add("game-button", "give-up");

        actionButton.addEventListener("click", () => {
          if (!gameOver) {
            giveUp();
          } else {
            restartGame();
          }
        });

        document.body.appendChild(actionButton);

        // æ›´æ–°æŒ‰é’®çŠ¶æ€çš„å‡½æ•°
        window.updateActionButton = function () {
          const button = document.getElementById("actionButton");
          if (button) {
            if (gameOver) {
              button.innerHTML = "RESTART";
              button.classList.remove("give-up");
              button.classList.add("restart");
            } else {
              button.innerHTML = "GIVE UP";
              button.classList.remove("restart");
              button.classList.add("give-up");
            }
          }
        };
      };
    </script>
  </body>
</html>
